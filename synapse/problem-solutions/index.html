<!DOCTYPE html>
<html class="no-js" lang="en"> <head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><meta content="Notes from day to day tasks" name="description"/><meta content="Padam Shrestha" name="author"/><link href="../../assets/images/favicon.png" rel="icon"/><meta content="mkdocs-1.5.3, mkdocs-material-8.5.7" name="generator"/><title>üîì Synapse / PySpark problem and solutions - Blog</title><link href="../../assets/stylesheets/main.20d9efc8.min.css" rel="stylesheet"/><link href="../../assets/stylesheets/palette.cbb835fc.min.css" rel="stylesheet"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href="../../assets/stylesheets/extra.css" rel="stylesheet"/><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-08DR4DTC9K"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-08DR4DTC9K",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-08DR4DTC9K",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gdesc-inner { font-size: 0.75rem; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                </style><script src="../../assets/javascripts/glightbox.min.js"></script></head> <body data-md-color-accent="indigo" data-md-color-primary="light-blue" data-md-color-scheme="slate" dir="ltr"> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/> <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a class="md-skip" href="#synapse-pyspark-problem-and-solutions"> Skip to content </a> </div> <div data-md-component="announce"> </div> <header class="md-header" data-md-component="header"> <nav aria-label="Header" class="md-header__inner md-grid"> <a aria-label="Blog" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Blog"> <img alt="logo" src="../../assets/images/blog_logo.png"/> </a> <label class="md-header__button md-icon" for="__drawer"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> Blog </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> üîì Synapse / PySpark problem and solutions </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="light-blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg> </label> <input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="red" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_2" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg> </label> </form> <label class="md-header__button md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/> <label class="md-search__icon md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label="Search" class="md-search__options"> <button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> <div class="md-search__suggest" data-md-component="search-suggest"></div> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" data-md-scrollfix=""> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list"></ol> </div> </div> </div> </div> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a aria-label="Blog" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Blog"> <img alt="logo" src="../../assets/images/blog_logo.png"/> </a> Blog </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../.."> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/> <label class="md-nav__link" for="__nav_2"> Synapse <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Synapse" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_2"> <span class="md-nav__icon md-icon"></span> Synapse </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../build-dev-pyspark-cluster/"> üê≥ Build Development Spark cluster - PySpark, Delta Lake </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../pyspark-dataframe-api/"> üìù PySpark Quickstart </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../pyspark-cheat-sheet/"> üìÑ PySpark Cheat Sheet </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../pyspark-azure-tables/"> ‚ú® Creating tables in PySpark Azure </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../explore/spark-delta-partition/"> Creating partition in delta lake with spark </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../explore/generate-stock-schema-delta-api/"> Design stock and option schema and provide fast api to access using spark delta </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../introduction/"> üìò Synapse Introduction </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/> <label class="md-nav__link md-nav__link--active" for="__toc"> üîì Synapse / PySpark problem and solutions <span class="md-nav__icon md-icon"></span> </label> <a class="md-nav__link md-nav__link--active" href="./"> üîì Synapse / PySpark problem and solutions </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#sql-server-to-pyspark-in-synapse"> Sql Server to PySpark in Synapse </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#check-file-exists-in-pyspark-or-python"> Check file exists in PySpark or Python </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#check-file-in-adls"> Check file in ADLS </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#try-catch-in-python"> Try catch in python </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#get-latest-file-from-datalake-using-pyspark-in-synapse"> Get latest file from datalake using pyspark in synapse </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#using-mssparkutils-in-synapse-to-get-latest-file-from-adls"> Using mssparkutils in synapse to get latest file from ADLS </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#how-to-partition-and-query-efficiently-parquet-file-in-data-lake-or-adls-using-pyspark"> How to partition and query efficiently parquet file in data lake or ADLS using pyspark </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#what-should-be-the-value-for-sparksqlanalyzermaxiternations"> What should be the value for spark.sql.analyzer.maxIternations </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#create-sql-user-defined-table-type"> Create SQL user-defined table type </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../explore/data-dcitionary-pipeline/"> üß∫ Data dictionary for metadata driven Synapse pipeline </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../pyspark-courses/"> üîÖ Courses and Tutorials </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../links/"> üîó Synapse links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/> <label class="md-nav__link" for="__nav_3"> Python <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Python" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_3"> <span class="md-nav__icon md-icon"></span> Python </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../python/python-basics/"> üêç Python Basics </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../python/create-python-package/"> üì¶ Create Custom Python Package </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../python/python-courses/"> üìô Courses and Tutorials </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../python/links/"> üîó Python links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/> <label class="md-nav__link" for="__nav_4"> Dotnet <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Dotnet" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_4"> <span class="md-nav__icon md-icon"></span> Dotnet </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-7/"> What's new in C# 7.0 through C# 7.3 </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-8/"> What's new in C# 8.0 </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-9/"> What's new in C# 9.0 - C# Guide </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-10/"> What's new in C# 10 - C# Guide </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-11/"> What's new in C# 11 - C# Guide </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/> <label class="md-nav__link" for="__nav_5"> Microservices <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Microservices" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_5"> <span class="md-nav__icon md-icon"></span> Microservices </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../microservices/grafana-dashboards/"> Grafana Dashboards </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../microservices/azure-function-dapr/"> Azure function with Dapr to create event-driven, distributed application </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../microservices/dapr-resources/"> Resources </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../microservices/links/"> üîó Dapr links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/> <label class="md-nav__link" for="__nav_6"> Serverless <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Serverless" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_6"> <span class="md-nav__icon md-icon"></span> Serverless </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../serverless/links/"> üîó Azure Serverless links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" id="__nav_7" type="checkbox"/> <label class="md-nav__link" for="__nav_7"> Azure <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Azure" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_7"> <span class="md-nav__icon md-icon"></span> Azure </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/azure-resource-graph-explorer/"> Write query using Azure Resource Graph Explorer </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/azure-keyboard-shortcuts/"> Azure Keyboard Shortcuts in Azure Portal </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/azure-service-fabric/"> Introduction to Azure Service Fabric </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/starting-azure-service-fabric/"> Starting Azure Service Fabric </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../azure/links/"> üîó Azure links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" id="__nav_8" type="checkbox"/> <label class="md-nav__link" for="__nav_8"> Spark <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Spark" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_8"> <span class="md-nav__icon md-icon"></span> Spark </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/jupyter-pyspark-docker/"> Run Jupyter for Pyspark on Docker </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/dotnet-spark-learning/"> Spark Machine Learning </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/dotnet-spark-docker/"> Run and Debug Dotnet Spark application on Docker </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/dotnet-spark-ubuntu/"> Install Dotnet Spark on Ubuntu </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/dotnet-spark-docker-ubuntu/"> Running Dotnet Spark applications on Ubuntu Continer </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/install-docker-ubuntu2004/"> Install Docker on Ubuntu 20.04 LTS and Dotnet Spark on Docker </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/python-learning/"> Learning Python </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/links/"> üîó Spark links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" id="__nav_9" type="checkbox"/> <label class="md-nav__link" for="__nav_9"> Kusto <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Kusto" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_9"> <span class="md-nav__icon md-icon"></span> Kusto </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/kusto-overview/"> Kusto Query Language (KQL) </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/dynamic-365-hcm-kusto/"> Troubleshoot using Kusto </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" id="__nav_10" type="checkbox"/> <label class="md-nav__link" for="__nav_10"> Angular <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Angular" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_10"> <span class="md-nav__icon md-icon"></span> Angular </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/deploy-angular-app-to-github-io-pages/"> Deploy Angular app to github.io pages </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" id="__nav_11" type="checkbox"/> <label class="md-nav__link" for="__nav_11"> Tools and Tricks <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Tools and Tricks" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_11"> <span class="md-nav__icon md-icon"></span> Tools and Tricks </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../explore/fastapi-uvicorn/"> Configure Fast API with Uvicorn in Dockerfile </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/limited_access_pat_token/"> Create Git PAT token with limited access. </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/multiple-remote-git/"> Multiple remote git configuration for repository </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/chocolatey/"> Install and manage applications using Chocolatey </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/keyboard-shortcuts/"> Keyboard shortcuts for everyday tasks </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/error-solutions/"> Everyday error and fixes </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/certificates/"> Searching and Installing Certificates </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/install-vscode-ubuntu/"> Install VS Code on Ubuntu </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/install-brave-ubuntu2004/"> Install Brave browser on Ubuntu 20.04 LTS </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/useful-online-tools/"> ‚öí Useful online tools </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/helpful-links/"> üîó Helpful links </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/nuget/"> Nuget Package Manger </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/docker/"> üê≥ Installing and Running Docker in WSL with VS Code </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/dotnetcore-azurefunction-wsl/"> Install dotnet core 3.1 and azure-functions-core-tools on WSL </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/configure-publish-mkdocs-github/"> üìö Configure Mkdocs and Auto deploy to Github.io </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/rename-dotnet-3-6/"> Migrate Dotnet Core 3.1 to DotNet 6.0 </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/git-help/"> Git </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/install-dotnet-sdk-armx64/"> Install dotnet skd on Mac m1 armx64 </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/windows-tricks/"> Windows tricks </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/linux-commands/"> Useful linux commands </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" id="__nav_12" type="checkbox"/> <label class="md-nav__link" for="__nav_12"> Courses, Projects, Tutorials, Blogs <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Courses, Projects, Tutorials, Blogs" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_12"> <span class="md-nav__icon md-icon"></span> Courses, Projects, Tutorials, Blogs </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../courses-projects/coursera/"> Coursera Courses </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../courses-projects/github_project/"> Github repo and projects </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" id="__nav_13" type="checkbox"/> <label class="md-nav__link" for="__nav_13"> Finance <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Finance" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_13"> <span class="md-nav__icon md-icon"></span> Finance </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../finance/use_of_ft/"> Fourier Transform in Price </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_14" id="__nav_14" type="checkbox"/> <label class="md-nav__link" for="__nav_14"> Random <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Random" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_14"> <span class="md-nav__icon md-icon"></span> Random </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../random/links/"> üîó Random useful links </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tags/"> Tags </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#sql-server-to-pyspark-in-synapse"> Sql Server to PySpark in Synapse </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#check-file-exists-in-pyspark-or-python"> Check file exists in PySpark or Python </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#check-file-in-adls"> Check file in ADLS </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#try-catch-in-python"> Try catch in python </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#get-latest-file-from-datalake-using-pyspark-in-synapse"> Get latest file from datalake using pyspark in synapse </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#using-mssparkutils-in-synapse-to-get-latest-file-from-adls"> Using mssparkutils in synapse to get latest file from ADLS </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#how-to-partition-and-query-efficiently-parquet-file-in-data-lake-or-adls-using-pyspark"> How to partition and query efficiently parquet file in data lake or ADLS using pyspark </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#what-should-be-the-value-for-sparksqlanalyzermaxiternations"> What should be the value for spark.sql.analyzer.maxIternations </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#create-sql-user-defined-table-type"> Create SQL user-defined table type </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <h1 id="synapse-pyspark-problem-and-solutions">üîì Synapse / PySpark problem and solutions<a class="headerlink" href="#synapse-pyspark-problem-and-solutions" title="Permanent link">¬∂</a></h1> <h2 id="sql-server-to-pyspark-in-synapse">Sql Server to PySpark in Synapse<a class="headerlink" href="#sql-server-to-pyspark-in-synapse" title="Permanent link">¬∂</a></h2> <p>To create a DataFrame in PySpark that reads data from a table in SQL Server using Synapse, you can use the following code as an example:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="c1"># Create a SparkSession</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span> \
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">"Read from SQL Server table"</span><span class="p">)</span> \
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.sql.databricks.directSQL.enabled"</span><span class="p">,</span> <span class="s2">"true"</span><span class="p">)</span> \
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.databricks.io.cache.enabled"</span><span class="p">,</span> <span class="s2">"true"</span><span class="p">)</span> \
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.databricks.io.cache.maxBytes"</span><span class="p">,</span> <span class="s2">"2g"</span><span class="p">)</span> \
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a>    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.databricks.io.cache.ttl"</span><span class="p">,</span> <span class="s2">"10m"</span><span class="p">)</span> \
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="c1"># Create a DataFrame that reads data from the specified SQL Server table</span>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="n">table_name</span> <span class="o">=</span> <span class="s2">"[dbo].[your_table_name]"</span>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="n">url</span> <span class="o">=</span> <span class="s2">"jdbc:sqlserver://your_server_name.database.windows.net:1433;database=your_database_name"</span>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="n">properties</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"user"</span><span class="p">:</span> <span class="s2">"your_username"</span><span class="p">,</span> <span class="s2">"password"</span><span class="p">:</span> <span class="s2">"your_password"</span><span class="p">,</span> <span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"com.microsoft.sqlserver.jdbc.SQLServerDriver"</span><span class="p">}</span>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">jdbc</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">)</span>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a>
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="c1"># Show the DataFrame</span>
<a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div> <p>Please modify the values in the properties such as user, password, table name, server and database name accordingly to make sure the code works for you. You also have to have the sqlserver connector downloaded in your environment.</p> <div class="highlight"><span class="filename">Bash Session</span><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="go">!pip install pyspark-sql-mssql</span>
</code></pre></div> <h2 id="check-file-exists-in-pyspark-or-python">Check file exists in PySpark or Python<a class="headerlink" href="#check-file-exists-in-pyspark-or-python" title="Permanent link">¬∂</a></h2> <p>In PySpark, you can use the os.path module from the Python standard library to check if a file exists. Here is an example of how you can use the os.path.exists() function to check if a file exists:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kn">import</span> <span class="nn">os</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="n">file_path</span> <span class="o">=</span> <span class="s2">"/path/to/your/file"</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"File exists."</span><span class="p">)</span>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="k">else</span><span class="p">:</span>
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"File does not exist."</span><span class="p">)</span>
</code></pre></div> <p>Alternatively, you could also use os.path.isfile() function to check if a path points to a regular file. <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"File exists."</span><span class="p">)</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="k">else</span><span class="p">:</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"File does not exist."</span><span class="p">)</span>
</code></pre></div></p> <p>!!!note that in both cases, file_path should be a string representing the path to the file you want to check.</p> <div class="highlight"><span class="filename">Text Only</span><pre><span></span><code>You also can use spark.sql to check the existance of a file in hadoop filesystem, you can use the spark.sql("""SHOW PARTITIONS tablename""") or spark.sql("""describe formatted tablename""") to check if a file exist or not.
</code></pre></div> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">"CheckFileExist"</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="n">file_path</span> <span class="o">=</span> <span class="s2">"/path/to/your/file"</span>
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="n">results</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">"describe formatted </span><span class="si">{file_path}</span><span class="s2">"</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="k">if</span> <span class="n">results</span><span class="p">:</span>
<a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"File exists."</span><span class="p">)</span>
<a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="k">else</span><span class="p">:</span>
<a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"File does not exist."</span><span class="p">)</span>
</code></pre></div> <p>It will work for file that is in hadoop filesystem.</p> <h2 id="check-file-in-adls">Check file in ADLS<a class="headerlink" href="#check-file-in-adls" title="Permanent link">¬∂</a></h2> <p>To check if a file exists in Azure Data Lake Storage (ADLS) using PySpark, you can use the dbutils.fs module from the Databricks environment. The dbutils.fs.ls() function can be used to list the files in a directory, and you can check the length of the returned list to see if a file exists. Here is an example:</p> <p><div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">from</span> <span class="nn">pyspark.dbutils</span> <span class="kn">import</span> <span class="n">DBUtils</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="n">file_path</span> <span class="o">=</span> <span class="s2">"adl://yourstorageaccount.azuredatalakestore.net/path/to/your/file"</span>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="n">dbutils</span> <span class="o">=</span> <span class="n">DBUtils</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="n">results</span> <span class="o">=</span> <span class="n">dbutils</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"File exists."</span><span class="p">)</span>
<a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="k">else</span><span class="p">:</span>
<a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"File does not exist."</span><span class="p">)</span>
</code></pre></div> Alternatively, you could also use dbutils.fs.exists(path) function to check file exist or not</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">from</span> <span class="nn">pyspark.dbutils</span> <span class="kn">import</span> <span class="n">DBUtils</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="n">file_path</span> <span class="o">=</span> <span class="s2">"adl://yourstorageaccount.azuredatalakestore.net/path/to/your/file"</span>
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="n">dbutils</span> <span class="o">=</span> <span class="n">DBUtils</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
<a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="n">exist</span> <span class="o">=</span> <span class="n">dbutils</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
<a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a>
<a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="k">if</span> <span class="n">exist</span><span class="p">:</span>
<a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"File exists."</span><span class="p">)</span>
<a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="k">else</span><span class="p">:</span>
<a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"File does not exist."</span><span class="p">)</span>
</code></pre></div> <p>Please make sure that the connection to the ADLS is setup properly, by providing the right credentials, such as client ID, client secret, tenant ID, and subscription ID or using service principle. You have to have the azure-storage and azure-storage-file-datalake package installed in your environment.</p> <div class="highlight"><span class="filename">Bash Session</span><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="go">!pip install azure-storage</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="go">!pip install azure-storage-file-datalake</span>
</code></pre></div> <h2 id="try-catch-in-python">Try catch in python<a class="headerlink" href="#try-catch-in-python" title="Permanent link">¬∂</a></h2> <p>In Python, try and except are used to handle exceptions, which are events that occur during the execution of a program that disrupt the normal flow of instructions.</p> <p>The try block contains the code that may raise an exception. If an exception is raised within the try block, the code in the corresponding except block will be executed. If no exception is raised, the code in the except block will be skipped.</p> <p>Here is an example of how to use the try and except statements in Python:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">try</span><span class="p">:</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>    <span class="c1"># some code that may raise an exception</span>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a>    <span class="c1"># code to be executed if the exception is raised</span>
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Cannot divide by zero."</span><span class="p">)</span>
</code></pre></div> <p>In this example, the try block contains code that tries to divide 1 by 0, which raises a ZeroDivisionError exception. The except block contains code that prints a message if this exception is raised.</p> <p>You can also use finally block, which contains code that will be executed no matter whether an exception is raised or not.</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="k">try</span><span class="p">:</span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>    <span class="c1"># some code that may raise an exception</span>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a>    <span class="c1"># code to be executed if the exception is raised</span>
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Cannot divide by zero."</span><span class="p">)</span>
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="k">finally</span><span class="p">:</span>
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Closing any open resources"</span><span class="p">)</span>
</code></pre></div> <p>You also can chain multiple except block, to handle different type of exception and different action correspondingly</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="k">try</span><span class="p">:</span>
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>    <span class="c1"># some code that may raise an exception</span>
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a>    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
<a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a>    <span class="c1"># code to be executed if ZeroDivisionError exception is raised</span>
<a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Cannot divide by zero."</span><span class="p">)</span>
<a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a>    <span class="c1"># code to be executed if any exception other than ZeroDivisionError exception is raised</span>
<a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"an error occur : </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div> <p>It's a good practice to always handle the exceptions, to prevent the application from crashing, or unexpected behavior.</p> <h2 id="get-latest-file-from-datalake-using-pyspark-in-synapse">Get latest file from datalake using pyspark in synapse<a class="headerlink" href="#get-latest-file-from-datalake-using-pyspark-in-synapse" title="Permanent link">¬∂</a></h2> <p>You can use the dbutils.fs module from the Databricks environment in Synapse to get the latest file from a directory in Azure Data Lake Storage (ADLS). Here's an example of how you can do this:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kn">from</span> <span class="nn">pyspark.dbutils</span> <span class="kn">import</span> <span class="n">DBUtils</span>
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>
<a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="n">dbutils</span> <span class="o">=</span> <span class="n">DBUtils</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
<a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a>
<a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="c1"># directory path in ADLS</span>
<a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="n">dir_path</span> <span class="o">=</span> <span class="s2">"adl://yourstorageaccount.azuredatalakestore.net/path/to/directory"</span>
<a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a>
<a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="c1"># list all files in the directory</span>
<a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="n">files</span> <span class="o">=</span> <span class="n">dbutils</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
<a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a>
<a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="c1"># sort files by last modification time and get the latest file</span>
<a href="#__codelineno-11-12" id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="n">latest_file</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">modtime</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a href="#__codelineno-11-13" id="__codelineno-11-13" name="__codelineno-11-13"></a>
<a href="#__codelineno-11-14" id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'latest file is </span><span class="si">{</span><span class="n">latest_file</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</code></pre></div> <p>his code lists all the files in the specified directory in ADLS using the dbutils.fs.ls() function, then sorts the files by the last modification time in descending order, so that the latest file is at the top of the list. Then it access the first element of the list which is the latest file. It will print the path of the latest file.</p> <p>Please make sure that the connection to the ADLS is setup properly, by providing the right credentials, such as client ID, client secret, tenant ID, and subscription ID or using service principle. You have to have the azure-storage and azure-storage-file-datalake package installed in your environment.</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">azure</span><span class="o">-</span><span class="n">storage</span>
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">azure</span><span class="o">-</span><span class="n">storage</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">datalake</span>
</code></pre></div> <p>You also can filter based on file type or regex on filename if needed before sorting the files</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="n">files</span> <span class="o">=</span> <span class="n">dbutils</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="n">files</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.csv'</span><span class="p">),</span> <span class="n">files</span><span class="p">)</span>
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="n">latest_file</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">modtime</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div> <h2 id="using-mssparkutils-in-synapse-to-get-latest-file-from-adls">Using mssparkutils in synapse to get latest file from ADLS<a class="headerlink" href="#using-mssparkutils-in-synapse-to-get-latest-file-from-adls" title="Permanent link">¬∂</a></h2> <p>In Synapse, you can use the mssparkutils library to retrieve the latest file from Azure Data Lake Storage (ADLS) using PySpark. This library provides a getLatestFile() function that allows you to retrieve the latest file from a given directory in ADLS.</p> <p>Here's an example of how you can use the mssparkutils.fileio.datalake.getLatestFile() function to retrieve the latest file from ADLS:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kn">from</span> <span class="nn">mssparkutils.fileio.datalake</span> <span class="kn">import</span> <span class="n">getLatestFile</span>
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a>
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="n">path</span> <span class="o">=</span> <span class="s2">"adl://yourstorageaccount.azuredatalakestore.net/path/to/your/directory"</span>
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="n">latest_file</span> <span class="o">=</span> <span class="n">getLatestFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="nb">print</span><span class="p">(</span><span class="n">latest_file</span><span class="p">)</span>
</code></pre></div> <p>You can also specify a date pattern and/or a file extension to narrow down the search:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="n">latest_file</span> <span class="o">=</span> <span class="n">getLatestFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">date_pattern</span> <span class="o">=</span> <span class="s2">"yyyyMMdd"</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">".csv"</span><span class="p">)</span>
</code></pre></div> <p>You have to have the mssparkutils package installed in your environment</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">mssparkutils</span>
</code></pre></div> <p>This function use the dbutils module to get the files, so make sure that the connection to the ADLS is set up properly, by providing the right credentials, such as client ID, client secret, tenant ID, and subscription ID or using service principle. This solution is a more robust and versatile approach, that considers both the lexicographical ordering of the files and their modification date to ensure that the correct latest file is returned.</p> <h2 id="how-to-partition-and-query-efficiently-parquet-file-in-data-lake-or-adls-using-pyspark">How to partition and query efficiently parquet file in data lake or ADLS using pyspark<a class="headerlink" href="#how-to-partition-and-query-efficiently-parquet-file-in-data-lake-or-adls-using-pyspark" title="Permanent link">¬∂</a></h2> <p>Parquet is a columnar storage format that is well-suited for storing large, complex datasets. Partitioning the data in Parquet format can improve the efficiency of queries by allowing Spark to only scan the necessary data, rather than the entire dataset.</p> <p>Here's an example of how you can partition a DataFrame in PySpark and write it to a Parquet file in Azure Data Lake Storage (ADLS) using the partitionBy() method:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="c1"># Create a DataFrame</span>
<a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"id % 10 as mod_10"</span><span class="p">)</span>
<a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a>
<a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="c1"># Partition the DataFrame by the "mod_10" column</span>
<a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">"mod_10"</span><span class="p">)</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="s2">"adl://yourstorageaccount.azuredatalakestore.net/path/to/your/directory"</span><span class="p">)</span>
</code></pre></div> <p>Once the data is partitioned, you can use the filter() function to only scan the necessary partitions when querying the data:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1"># read parquet data</span>
<a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="n">df_parquet</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="s2">"adl://yourstorageaccount.azuredatalakestore.net/path/to/your/directory"</span><span class="p">)</span>
<a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="c1"># filter only data where `mod_10` is 5</span>
<a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="n">df_parquet</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"mod_10"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div> <p>You can also use predicate pushdown feature to push the filter conditions to the storage layer instead of doing the filtering in Spark, this approach further improves query performance by reducing the amount of data that needs to be read and processed.</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="c1"># read parquet data and enable predicate pushdown</span>
<a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="n">df_parquet</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="s2">"adl://yourstorageaccount.azuredatalakestore.net/path/to/your/directory"</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">"mod_10 = 5"</span><span class="p">)</span>
<a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="n">df_parquet</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div> <p>You also have to have the azure-storage and azure-storage-file-datalake package installed in your environment.</p> <div class="highlight"><span class="filename">Bash Session</span><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="go">!pip install azure-storage</span>
<a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="go">!pip install azure-storage-file-datalake</span>
</code></pre></div> <p>And make sure that the connection to the ADLS is set up properly, by providing the right credentials, such as client ID, client secret, tenant ID, and subscription ID or using service principle. By partitioning and filtering the data in this way, you can improve the performance of your queries by reducing the amount of data that Spark needs to scan and process.</p> <p>It's also important to mention that it would be best to be selective in the partitioning key, using a high cardinality column, such as date or timestamp, will increase the number of small partitions which will increase the number of metadata that needs to be scanned and may cause performance degradation rather than improvement.</p> <h2 id="what-should-be-the-value-for-sparksqlanalyzermaxiternations">What should be the value for spark.sql.analyzer.maxIternations<a class="headerlink" href="#what-should-be-the-value-for-sparksqlanalyzermaxiternations" title="Permanent link">¬∂</a></h2> <p>The spark.sql.analyzer.maxIterations configuration property sets the maximum number of iterations that Spark's Catalyst optimizer will perform when analyzing a query plan. The Catalyst optimizer is the optimization engine that is used by Spark SQL to analyze and optimize query plans.</p> <p>The default value for spark.sql.analyzer.maxIterations is 100. This means that the Catalyst optimizer will perform up to 100 iterations to optimize a query plan. In most cases, this default value should be sufficient for most queries.</p> <p>However, in certain cases, increasing the value of spark.sql.analyzer.maxIterations may be beneficial. For example, if you have a particularly complex query or if the Catalyst optimizer is not able to find the optimal query plan in the default 100 iterations, then increasing this value may help. However, increasing the number of iterations will increase the amount of time required to analyze and optimize the query plan.</p> <p>It's worth noting that in some cases, an increase in the number of iterations does not necessary lead to a better optimized plan, it may lead to an increase in the cost of the plan instead, causing performance degradation.</p> <p>It is recommended to test different values for spark.sql.analyzer.maxIterations to find</p> <h2 id="create-sql-user-defined-table-type">Create SQL user-defined table type<a class="headerlink" href="#create-sql-user-defined-table-type" title="Permanent link">¬∂</a></h2> <p>To create a user-defined table type with the specified columns in SQL, you can use the following script:</p> <div class="highlight"><span class="filename">SQL</span><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">dbo</span><span class="p">.</span><span class="n">MyTableType</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TABLE</span>
<a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="p">(</span>
<a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="n">Security_ID</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">    </span><span class="n">IsInit</span><span class="w"> </span><span class="nb">BIT</span><span class="p">,</span>
<a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">    </span><span class="n">IsBuyList</span><span class="w"> </span><span class="nb">BIT</span><span class="p">,</span>
<a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">    </span><span class="n">IsComposite</span><span class="w"> </span><span class="nb">BIT</span><span class="p">,</span>
<a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">    </span><span class="n">IsPenalty</span><span class="w"> </span><span class="nb">BIT</span><span class="p">,</span>
<a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">    </span><span class="n">PROJECT_NAME</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">    </span><span class="n">CreatedDatetime</span><span class="w"> </span><span class="n">DATETIME</span><span class="p">,</span>
<a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">    </span><span class="n">CreatedBy</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="w">    </span><span class="n">UpdatedDatetime</span><span class="w"> </span><span class="n">DATETIME</span><span class="p">,</span>
<a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="w">    </span><span class="n">UpdatedBy</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<a href="#__codelineno-21-13" id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="p">);</span>
</code></pre></div> <p>This script creates a user-defined table type called dbo.MyTableType with the specified columns: Security_ID, IsInit, IsBuyList, IsComposite, IsPenalty, PROJECT_NAME, CreatedDatetime, CreatedBy, UpdatedDatetime, UpdatedBy.</p> <p>The script uses the CREATE TYPE statement to create a new user-defined table type and the AS TABLE clause to define the structure of the table type. Each column is defined with a name and data type.</p> <p>You can use this table type as a parameter in stored procedures, User defined functions or even in other table types.</p> <div class="highlight"><span class="filename">SQL</span><pre><span></span><code><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">sp_MyProcedure</span>
<a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="p">(</span><span class="o">@</span><span class="n">table_param</span><span class="w"> </span><span class="n">dbo</span><span class="p">.</span><span class="n">MyTableType</span><span class="w"> </span><span class="n">READONLY</span><span class="p">)</span>
<a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="k">AS</span>
<a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="k">BEGIN</span>
<a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">@</span><span class="n">table_param</span><span class="p">;</span>
<a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="k">END</span>
</code></pre></div> </article> </div> </div> </main> <footer class="md-footer"> <nav aria-label="Footer" class="md-footer__inner md-grid"> <a aria-label="Previous: üìò Synapse Introduction" class="md-footer__link md-footer__link--prev" href="../introduction/" rel="prev"> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </div> <div class="md-footer__title"> <div class="md-ellipsis"> <span class="md-footer__direction"> Previous </span> üìò Synapse Introduction </div> </div> </a> <a aria-label="Next: üß∫ Data dictionary for metadata driven Synapse pipeline" class="md-footer__link md-footer__link--next" href="../../explore/data-dcitionary-pipeline/" rel="next"> <div class="md-footer__title"> <div class="md-ellipsis"> <span class="md-footer__direction"> Next </span> üß∫ Data dictionary for metadata driven Synapse pipeline </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> Made with <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank"> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <script id="__config" type="application/json">{"base": "../..", "features": ["search.highlight", "search.suggest", "header.autohide"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src="../../assets/javascripts/bundle.8492ddcf.min.js"></script> <script src="../../assets/javascripts/extra.js"></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body> </html>