<!DOCTYPE html>
<html class="no-js" lang="en"> <head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><meta content="Notes from day to day tasks" name="description"/><meta content="Padam Shrestha" name="author"/><link href="../../assets/images/favicon.png" rel="icon"/><meta content="mkdocs-1.5.3, mkdocs-material-8.5.7" name="generator"/><title>📄 PySpark Cheat Sheet - Blog</title><link href="../../assets/stylesheets/main.20d9efc8.min.css" rel="stylesheet"/><link href="../../assets/stylesheets/palette.cbb835fc.min.css" rel="stylesheet"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href="../../assets/stylesheets/extra.css" rel="stylesheet"/><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-08DR4DTC9K"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-08DR4DTC9K",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-08DR4DTC9K",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gdesc-inner { font-size: 0.75rem; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                </style><script src="../../assets/javascripts/glightbox.min.js"></script></head> <body data-md-color-accent="indigo" data-md-color-primary="light-blue" data-md-color-scheme="slate" dir="ltr"> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/> <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a class="md-skip" href="#pyspark-cheat-sheet"> Skip to content </a> </div> <div data-md-component="announce"> </div> <header class="md-header" data-md-component="header"> <nav aria-label="Header" class="md-header__inner md-grid"> <a aria-label="Blog" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Blog"> <img alt="logo" src="../../assets/images/blog_logo.png"/> </a> <label class="md-header__button md-icon" for="__drawer"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> Blog </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> 📄 PySpark Cheat Sheet </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="light-blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg> </label> <input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="red" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_2" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg> </label> </form> <label class="md-header__button md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/> <label class="md-search__icon md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label="Search" class="md-search__options"> <button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> <div class="md-search__suggest" data-md-component="search-suggest"></div> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" data-md-scrollfix=""> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list"></ol> </div> </div> </div> </div> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a aria-label="Blog" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Blog"> <img alt="logo" src="../../assets/images/blog_logo.png"/> </a> Blog </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../.."> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/> <label class="md-nav__link" for="__nav_2"> Synapse <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Synapse" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_2"> <span class="md-nav__icon md-icon"></span> Synapse </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../build-dev-pyspark-cluster/"> 🐳 Build Development Spark cluster - PySpark, Delta Lake </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../pyspark-dataframe-api/"> 📝 PySpark Quickstart </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/> <label class="md-nav__link md-nav__link--active" for="__toc"> 📄 PySpark Cheat Sheet <span class="md-nav__icon md-icon"></span> </label> <a class="md-nav__link md-nav__link--active" href="./"> 📄 PySpark Cheat Sheet </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#common-patterns"> Common Patterns </a> <nav aria-label="Common Patterns" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#importing-functions-types"> Importing Functions &amp; Types </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#filtering"> Filtering </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#joins"> Joins </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#column-operations"> Column Operations </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#casting-coalescing-null-values-duplicates"> Casting &amp; Coalescing Null Values &amp; Duplicates </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#string-operations"> String Operations </a> <nav aria-label="String Operations" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#string-filters"> String Filters </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#string-functions"> String Functions </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#number-operations"> Number Operations </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#date-timestamp-operations"> Date &amp; Timestamp Operations </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#array-operations"> Array Operations </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#aggregation-operations"> Aggregation Operations </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#advanced-operations"> Advanced Operations </a> <nav aria-label="Advanced Operations" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#repartitioning"> Repartitioning </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#udfs-user-defined-functions"> UDFs (User Defined Functions </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../pyspark-azure-tables/"> ✨ Creating tables in PySpark Azure </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../explore/spark-delta-partition/"> Creating partition in delta lake with spark </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../explore/generate-stock-schema-delta-api/"> Design stock and option schema and provide fast api to access using spark delta </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../introduction/"> 📘 Synapse Introduction </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../problem-solutions/"> 🔓 Synapse / PySpark problem and solutions </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../explore/data-dcitionary-pipeline/"> 🧺 Data dictionary for metadata driven Synapse pipeline </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../pyspark-courses/"> 🔅 Courses and Tutorials </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../links/"> 🔗 Synapse links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/> <label class="md-nav__link" for="__nav_3"> Python <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Python" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_3"> <span class="md-nav__icon md-icon"></span> Python </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../python/python-basics/"> 🐍 Python Basics </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../python/create-python-package/"> 📦 Create Custom Python Package </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../python/python-courses/"> 📙 Courses and Tutorials </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../python/links/"> 🔗 Python links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/> <label class="md-nav__link" for="__nav_4"> Dotnet <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Dotnet" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_4"> <span class="md-nav__icon md-icon"></span> Dotnet </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-7/"> What's new in C# 7.0 through C# 7.3 </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-8/"> What's new in C# 8.0 </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-9/"> What's new in C# 9.0 - C# Guide </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-10/"> What's new in C# 10 - C# Guide </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-11/"> What's new in C# 11 - C# Guide </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/> <label class="md-nav__link" for="__nav_5"> Microservices <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Microservices" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_5"> <span class="md-nav__icon md-icon"></span> Microservices </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../microservices/grafana-dashboards/"> Grafana Dashboards </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../microservices/azure-function-dapr/"> Azure function with Dapr to create event-driven, distributed application </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../microservices/dapr-resources/"> Resources </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../microservices/links/"> 🔗 Dapr links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/> <label class="md-nav__link" for="__nav_6"> Serverless <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Serverless" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_6"> <span class="md-nav__icon md-icon"></span> Serverless </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../serverless/links/"> 🔗 Azure Serverless links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" id="__nav_7" type="checkbox"/> <label class="md-nav__link" for="__nav_7"> Azure <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Azure" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_7"> <span class="md-nav__icon md-icon"></span> Azure </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/azure-resource-graph-explorer/"> Write query using Azure Resource Graph Explorer </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/azure-keyboard-shortcuts/"> Azure Keyboard Shortcuts in Azure Portal </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/azure-service-fabric/"> Introduction to Azure Service Fabric </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/starting-azure-service-fabric/"> Starting Azure Service Fabric </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../azure/links/"> 🔗 Azure links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" id="__nav_8" type="checkbox"/> <label class="md-nav__link" for="__nav_8"> Spark <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Spark" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_8"> <span class="md-nav__icon md-icon"></span> Spark </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/jupyter-pyspark-docker/"> Run Jupyter for Pyspark on Docker </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/dotnet-spark-learning/"> Spark Machine Learning </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/dotnet-spark-docker/"> Run and Debug Dotnet Spark application on Docker </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/dotnet-spark-ubuntu/"> Install Dotnet Spark on Ubuntu </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/dotnet-spark-docker-ubuntu/"> Running Dotnet Spark applications on Ubuntu Continer </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/install-docker-ubuntu2004/"> Install Docker on Ubuntu 20.04 LTS and Dotnet Spark on Docker </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/python-learning/"> Learning Python </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/links/"> 🔗 Spark links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" id="__nav_9" type="checkbox"/> <label class="md-nav__link" for="__nav_9"> Kusto <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Kusto" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_9"> <span class="md-nav__icon md-icon"></span> Kusto </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/kusto-overview/"> Kusto Query Language (KQL) </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/dynamic-365-hcm-kusto/"> Troubleshoot using Kusto </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" id="__nav_10" type="checkbox"/> <label class="md-nav__link" for="__nav_10"> Angular <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Angular" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_10"> <span class="md-nav__icon md-icon"></span> Angular </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/deploy-angular-app-to-github-io-pages/"> Deploy Angular app to github.io pages </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" id="__nav_11" type="checkbox"/> <label class="md-nav__link" for="__nav_11"> Tools and Tricks <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Tools and Tricks" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_11"> <span class="md-nav__icon md-icon"></span> Tools and Tricks </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../explore/fastapi-uvicorn/"> Configure Fast API with Uvicorn in Dockerfile </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/limited_access_pat_token/"> Create Git PAT token with limited access. </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/multiple-remote-git/"> Multiple remote git configuration for repository </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/chocolatey/"> Install and manage applications using Chocolatey </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/keyboard-shortcuts/"> Keyboard shortcuts for everyday tasks </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/error-solutions/"> Everyday error and fixes </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/certificates/"> Searching and Installing Certificates </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/install-vscode-ubuntu/"> Install VS Code on Ubuntu </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/install-brave-ubuntu2004/"> Install Brave browser on Ubuntu 20.04 LTS </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/useful-online-tools/"> ⚒ Useful online tools </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/helpful-links/"> 🔗 Helpful links </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/nuget/"> Nuget Package Manger </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/docker/"> 🐳 Installing and Running Docker in WSL with VS Code </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/dotnetcore-azurefunction-wsl/"> Install dotnet core 3.1 and azure-functions-core-tools on WSL </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/configure-publish-mkdocs-github/"> 📚 Configure Mkdocs and Auto deploy to Github.io </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/rename-dotnet-3-6/"> Migrate Dotnet Core 3.1 to DotNet 6.0 </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/git-help/"> Git </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/install-dotnet-sdk-armx64/"> Install dotnet skd on Mac m1 armx64 </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/windows-tricks/"> Windows tricks </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/linux-commands/"> Useful linux commands </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" id="__nav_12" type="checkbox"/> <label class="md-nav__link" for="__nav_12"> Courses, Projects, Tutorials, Blogs <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Courses, Projects, Tutorials, Blogs" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_12"> <span class="md-nav__icon md-icon"></span> Courses, Projects, Tutorials, Blogs </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../courses-projects/coursera/"> Coursera Courses </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../courses-projects/github_project/"> Github repo and projects </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" id="__nav_13" type="checkbox"/> <label class="md-nav__link" for="__nav_13"> Finance <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Finance" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_13"> <span class="md-nav__icon md-icon"></span> Finance </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../finance/use_of_ft/"> Fourier Transform in Price </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_14" id="__nav_14" type="checkbox"/> <label class="md-nav__link" for="__nav_14"> Random <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Random" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_14"> <span class="md-nav__icon md-icon"></span> Random </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../random/links/"> 🔗 Random useful links </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tags/"> Tags </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#common-patterns"> Common Patterns </a> <nav aria-label="Common Patterns" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#importing-functions-types"> Importing Functions &amp; Types </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#filtering"> Filtering </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#joins"> Joins </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#column-operations"> Column Operations </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#casting-coalescing-null-values-duplicates"> Casting &amp; Coalescing Null Values &amp; Duplicates </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#string-operations"> String Operations </a> <nav aria-label="String Operations" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#string-filters"> String Filters </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#string-functions"> String Functions </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#number-operations"> Number Operations </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#date-timestamp-operations"> Date &amp; Timestamp Operations </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#array-operations"> Array Operations </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#aggregation-operations"> Aggregation Operations </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#advanced-operations"> Advanced Operations </a> <nav aria-label="Advanced Operations" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#repartitioning"> Repartitioning </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#udfs-user-defined-functions"> UDFs (User Defined Functions </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <h1 id="pyspark-cheat-sheet">📄 PySpark Cheat Sheet<a class="headerlink" href="#pyspark-cheat-sheet" title="Permanent link">¶</a></h1> <p>A quick reference guide to the most commonly used patterns and functions in PySpark SQL.</p> <p>If you can't find what you're looking for, check out the <a href="https://spark.apache.org/docs/latest/api/python/pyspark.sql.html">PySpark Official Documentation</a> and add it here!</p> <h2 id="common-patterns">Common Patterns<a class="headerlink" href="#common-patterns" title="Permanent link">¶</a></h2> <h4 id="importing-functions-types">Importing Functions &amp; Types<a class="headerlink" href="#importing-functions-types" title="Permanent link">¶</a></h4> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># Easily reference these as F.my_function() and T.my_type() below</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span><span class="p">,</span> <span class="n">types</span> <span class="k">as</span> <span class="n">T</span>
</code></pre></div> <h4 id="filtering">Filtering<a class="headerlink" href="#filtering" title="Permanent link">¶</a></h4> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># Filter on equals condition</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">is_adult</span> <span class="o">==</span> <span class="s1">'Y'</span><span class="p">)</span>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="c1"># Filter on &gt;, &lt;, &gt;=, &lt;= condition</span>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">)</span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="c1"># Multiple conditions require parentheses around each condition</span>
<a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">is_adult</span> <span class="o">==</span> <span class="s1">'Y'</span><span class="p">))</span>
<a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>
<a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="c1"># Compare against a list of allowed values</span>
<a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'first_name'</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">]))</span>
<a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a>
<a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="c1"># Sort results</span>
<a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">asc</span><span class="p">()))</span>
<a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">desc</span><span class="p">()))</span>
</code></pre></div> <h4 id="joins">Joins<a class="headerlink" href="#joins" title="Permanent link">¶</a></h4> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># Left join in another dataset</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">person_lookup_table</span><span class="p">,</span> <span class="s1">'person_id'</span><span class="p">,</span> <span class="s1">'left'</span><span class="p">)</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="c1"># Match on different columns in left &amp; right datasets</span>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other_table</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">other_table</span><span class="o">.</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">'left'</span><span class="p">)</span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="c1"># Match on multiple columns</span>
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other_table</span><span class="p">,</span> <span class="p">[</span><span class="s1">'first_name'</span><span class="p">,</span> <span class="s1">'last_name'</span><span class="p">],</span> <span class="s1">'left'</span><span class="p">)</span>
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a>
<a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="c1"># Useful for one-liner lookup code joins if you have a bunch</span>
<a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="k">def</span> <span class="nf">lookup_and_replace</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">df1_key</span><span class="p">,</span> <span class="n">df2_key</span><span class="p">,</span> <span class="n">df2_value</span><span class="p">):</span>
<a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a>    <span class="k">return</span> <span class="p">(</span>
<a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a>        <span class="n">df1</span>
<a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a>        <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">[[</span><span class="n">df2_key</span><span class="p">,</span> <span class="n">df2_value</span><span class="p">]],</span> <span class="n">df1</span><span class="p">[</span><span class="n">df1_key</span><span class="p">]</span> <span class="o">==</span> <span class="n">df2</span><span class="p">[</span><span class="n">df2_key</span><span class="p">],</span> <span class="s1">'left'</span><span class="p">)</span>
<a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a>        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">df1_key</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">coalesce</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">df2_value</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">df1_key</span><span class="p">)))</span>
<a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df2_key</span><span class="p">)</span>
<a href="#__codelineno-2-17" id="__codelineno-2-17" name="__codelineno-2-17"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df2_value</span><span class="p">)</span>
<a href="#__codelineno-2-18" id="__codelineno-2-18" name="__codelineno-2-18"></a>    <span class="p">)</span>
<a href="#__codelineno-2-19" id="__codelineno-2-19" name="__codelineno-2-19"></a>
<a href="#__codelineno-2-20" id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="n">df</span> <span class="o">=</span> <span class="n">lookup_and_replace</span><span class="p">(</span><span class="n">people</span><span class="p">,</span> <span class="n">pay_codes</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">pay_code_id</span><span class="p">,</span> <span class="n">pay_code_desc</span><span class="p">)</span>
</code></pre></div> <h4 id="column-operations">Column Operations<a class="headerlink" href="#column-operations" title="Permanent link">¶</a></h4> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1"># Add a new static column</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s1">'PASS'</span><span class="p">))</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="c1"># Construct a new dynamic column</span>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'full_name'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>    <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">fname</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">lname</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">()),</span> <span class="n">F</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">lname</span><span class="p">)</span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s1">'N/A'</span><span class="p">))</span>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="c1"># Pick which columns to keep, optionally rename some</span>
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>    <span class="s1">'name'</span><span class="p">,</span>
<a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a>    <span class="s1">'age'</span><span class="p">,</span>
<a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a>    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">'dob'</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'date_of_birth'</span><span class="p">),</span>
<a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="p">)</span>
<a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a>
<a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="c1"># Remove columns</span>
<a href="#__codelineno-3-17" id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'mod_dt'</span><span class="p">,</span> <span class="s1">'mod_username'</span><span class="p">)</span>
<a href="#__codelineno-3-18" id="__codelineno-3-18" name="__codelineno-3-18"></a>
<a href="#__codelineno-3-19" id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="c1"># Rename a column</span>
<a href="#__codelineno-3-20" id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s1">'dob'</span><span class="p">,</span> <span class="s1">'date_of_birth'</span><span class="p">)</span>
<a href="#__codelineno-3-21" id="__codelineno-3-21" name="__codelineno-3-21"></a>
<a href="#__codelineno-3-22" id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="c1"># Keep all the columns which also occur in another dataset</span>
<a href="#__codelineno-3-23" id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df2</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<a href="#__codelineno-3-24" id="__codelineno-3-24" name="__codelineno-3-24"></a>
<a href="#__codelineno-3-25" id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="c1"># Batch Rename/Clean Columns</span>
<a href="#__codelineno-3-26" id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a href="#__codelineno-3-27" id="__codelineno-3-27" name="__codelineno-3-27"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'-'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">))</span>
</code></pre></div> <h4 id="casting-coalescing-null-values-duplicates">Casting &amp; Coalescing Null Values &amp; Duplicates<a class="headerlink" href="#casting-coalescing-null-values-duplicates" title="Permanent link">¶</a></h4> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># Cast a column to a different type</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'price'</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">DoubleType</span><span class="p">()))</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="c1"># Replace all nulls with a specific value</span>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">({</span>
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>    <span class="s1">'first_name'</span><span class="p">:</span> <span class="s1">'Tom'</span><span class="p">,</span>
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a>    <span class="s1">'age'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="p">})</span>
<a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a>
<a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="c1"># Take the first value that is not null</span>
<a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'last_name'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">coalesce</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">last_name</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">surname</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s1">'N/A'</span><span class="p">)))</span>
<a href="#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a>
<a href="#__codelineno-4-13" id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="c1"># Drop duplicate rows in a dataset (distinct)</span>
<a href="#__codelineno-4-14" id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropDuplicates</span><span class="p">()</span>
<a href="#__codelineno-4-15" id="__codelineno-4-15" name="__codelineno-4-15"></a>
<a href="#__codelineno-4-16" id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="c1"># Drop duplicate rows, but consider only specific columns</span>
<a href="#__codelineno-4-17" id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropDuplicates</span><span class="p">([</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'height'</span><span class="p">])</span>
<a href="#__codelineno-4-18" id="__codelineno-4-18" name="__codelineno-4-18"></a>
<a href="#__codelineno-4-19" id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="c1"># Replace empty strings with null (leave out subset keyword arg to replace in all columns)</span>
<a href="#__codelineno-4-20" id="__codelineno-4-20" name="__codelineno-4-20"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s2">""</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">"name"</span><span class="p">])</span>
<a href="#__codelineno-4-21" id="__codelineno-4-21" name="__codelineno-4-21"></a>
<a href="#__codelineno-4-22" id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="c1"># Convert Python/PySpark/NumPy NaN operator to null</span>
<a href="#__codelineno-4-23" id="__codelineno-4-23" name="__codelineno-4-23"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">"nan"</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div> <h2 id="string-operations">String Operations<a class="headerlink" href="#string-operations" title="Permanent link">¶</a></h2> <h4 id="string-filters">String Filters<a class="headerlink" href="#string-filters" title="Permanent link">¶</a></h4> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1"># Contains - col.contains(string)</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">'o'</span><span class="p">))</span>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="c1"># Starts With - col.startswith(string)</span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'Al'</span><span class="p">))</span>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="c1"># Ends With - col.endswith(string)</span>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'ice'</span><span class="p">))</span>
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>
<a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="c1"># Is Null - col.isNull()</span>
<a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">is_adult</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span>
<a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a>
<a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="c1"># Is Not Null - col.isNotNull()</span>
<a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">first_name</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>
<a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a>
<a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="c1"># Like - col.like(string_with_sql_wildcards)</span>
<a href="#__codelineno-5-17" id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s1">'Al%'</span><span class="p">))</span>
<a href="#__codelineno-5-18" id="__codelineno-5-18" name="__codelineno-5-18"></a>
<a href="#__codelineno-5-19" id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="c1"># Regex Like - col.rlike(regex)</span>
<a href="#__codelineno-5-20" id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rlike</span><span class="p">(</span><span class="s1">'[A-Z]*ice$'</span><span class="p">))</span>
<a href="#__codelineno-5-21" id="__codelineno-5-21" name="__codelineno-5-21"></a>
<a href="#__codelineno-5-22" id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="c1"># Is In List - col.isin(*cols)</span>
<a href="#__codelineno-5-23" id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s1">'Bob'</span><span class="p">,</span> <span class="s1">'Mike'</span><span class="p">))</span>
</code></pre></div> <h4 id="string-functions">String Functions<a class="headerlink" href="#string-functions" title="Permanent link">¶</a></h4> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1"># Substring - col.substr(startPos, length)</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'short_id'</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="c1"># Trim - F.trim(col)</span>
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
<a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a>
<a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="c1"># Left Pad - F.lpad(col, len, pad)</span>
<a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="c1"># Right Pad - F.rpad(col, len, pad)</span>
<a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lpad</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">))</span>
<a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a>
<a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="c1"># Left Trim - F.ltrim(col)</span>
<a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="c1"># Right Trim - F.rtrim(col)</span>
<a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">ltrim</span><span class="p">(</span><span class="s1">'id'</span><span class="p">))</span>
<a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a>
<a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="c1"># Concatenate - F.concat(*cols)</span>
<a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'full_name'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="s1">'fname'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s1">' '</span><span class="p">),</span> <span class="s1">'lname'</span><span class="p">))</span>
<a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a>
<a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="c1"># Concatenate with Separator/Delimiter - F.concat_ws(delimiter, *cols)</span>
<a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'full_name'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">concat_ws</span><span class="p">(</span><span class="s1">'-'</span><span class="p">,</span> <span class="s1">'fname'</span><span class="p">,</span> <span class="s1">'lname'</span><span class="p">))</span>
<a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a>
<a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="c1"># Regex Replace - F.regexp_replace(str, pattern, replacement)[source]</span>
<a href="#__codelineno-6-22" id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">regexp_replace</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s1">'0F1(.*)'</span><span class="p">,</span> <span class="s1">'1F1-$1'</span><span class="p">))</span>
<a href="#__codelineno-6-23" id="__codelineno-6-23" name="__codelineno-6-23"></a>
<a href="#__codelineno-6-24" id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="c1"># Regex Extract - F.regexp_extract(str, pattern, idx)</span>
<a href="#__codelineno-6-25" id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">regexp_extract</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s1">'[0-9]*'</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</code></pre></div> <h2 id="number-operations">Number Operations<a class="headerlink" href="#number-operations" title="Permanent link">¶</a></h2> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1"># Round - F.round(col, scale=0)</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'price'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">'price'</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="c1"># Floor - F.floor(col)</span>
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'price'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s1">'price'</span><span class="p">))</span>
<a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a>
<a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="c1"># Ceiling - F.ceil(col)</span>
<a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'price'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="s1">'price'</span><span class="p">))</span>
<a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a>
<a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="c1"># Absolute Value - F.abs(col)</span>
<a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'price'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="s1">'price'</span><span class="p">))</span>
<a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a>
<a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="c1"># X raised to power Y – F.pow(x, y)</span>
<a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'exponential_growth'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="s1">'x'</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">))</span>
<a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a>
<a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="c1"># Select smallest value out of multiple columns – F.least(*cols)</span>
<a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'least'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">least</span><span class="p">(</span><span class="s1">'subtotal'</span><span class="p">,</span> <span class="s1">'total'</span><span class="p">))</span>
<a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a>
<a href="#__codelineno-7-19" id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="c1"># Select largest value out of multiple columns – F.greatest(*cols)</span>
<a href="#__codelineno-7-20" id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'greatest'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">greatest</span><span class="p">(</span><span class="s1">'subtotal'</span><span class="p">,</span> <span class="s1">'total'</span><span class="p">))</span>
</code></pre></div> <h2 id="date-timestamp-operations">Date &amp; Timestamp Operations<a class="headerlink" href="#date-timestamp-operations" title="Permanent link">¶</a></h2> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1"># Convert a string of known format to a date (excludes time information)</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'date_of_birth'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">to_date</span><span class="p">(</span><span class="s1">'date_of_birth'</span><span class="p">,</span> <span class="s1">'yyyy-MM-dd'</span><span class="p">))</span>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="c1"># Convert a string of known format to a timestamp (includes time information)</span>
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'time_of_birth'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">(</span><span class="s1">'time_of_birth'</span><span class="p">,</span> <span class="s1">'yyyy-MM-dd HH:mm:ss'</span><span class="p">))</span>
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>
<a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="c1"># Get year from date:       F.year(col)</span>
<a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="c1"># Get month from date:      F.month(col)</span>
<a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="c1"># Get day from date:        F.dayofmonth(col)</span>
<a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="c1"># Get hour from date:       F.hour(col)</span>
<a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="c1"># Get minute from date:     F.minute(col)</span>
<a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="c1"># Get second from date:     F.second(col)</span>
<a href="#__codelineno-8-13" id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">year</span><span class="p">(</span><span class="s1">'date_of_birth'</span><span class="p">)</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s1">'2017'</span><span class="p">))</span>
<a href="#__codelineno-8-14" id="__codelineno-8-14" name="__codelineno-8-14"></a>
<a href="#__codelineno-8-15" id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="c1"># Add &amp; subtract days</span>
<a href="#__codelineno-8-16" id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'three_days_after'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">date_add</span><span class="p">(</span><span class="s1">'date_of_birth'</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a href="#__codelineno-8-17" id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'three_days_before'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">date_sub</span><span class="p">(</span><span class="s1">'date_of_birth'</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a href="#__codelineno-8-18" id="__codelineno-8-18" name="__codelineno-8-18"></a>
<a href="#__codelineno-8-19" id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="c1"># Add &amp; Subtract months</span>
<a href="#__codelineno-8-20" id="__codelineno-8-20" name="__codelineno-8-20"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'next_month'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">add_month</span><span class="p">(</span><span class="s1">'date_of_birth'</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a href="#__codelineno-8-21" id="__codelineno-8-21" name="__codelineno-8-21"></a>
<a href="#__codelineno-8-22" id="__codelineno-8-22" name="__codelineno-8-22"></a><span class="c1"># Get number of days between two dates</span>
<a href="#__codelineno-8-23" id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'days_between'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">datediff</span><span class="p">(</span><span class="s1">'start'</span><span class="p">,</span> <span class="s1">'end'</span><span class="p">))</span>
<a href="#__codelineno-8-24" id="__codelineno-8-24" name="__codelineno-8-24"></a>
<a href="#__codelineno-8-25" id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="c1"># Get number of months between two dates</span>
<a href="#__codelineno-8-26" id="__codelineno-8-26" name="__codelineno-8-26"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'months_between'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">months_between</span><span class="p">(</span><span class="s1">'start'</span><span class="p">,</span> <span class="s1">'end'</span><span class="p">))</span>
<a href="#__codelineno-8-27" id="__codelineno-8-27" name="__codelineno-8-27"></a>
<a href="#__codelineno-8-28" id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="c1"># Keep only rows where date_of_birth is between 2017-05-10 and 2018-07-21</span>
<a href="#__codelineno-8-29" id="__codelineno-8-29" name="__codelineno-8-29"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
<a href="#__codelineno-8-30" id="__codelineno-8-30" name="__codelineno-8-30"></a>    <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">'date_of_birth'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s1">'2017-05-10'</span><span class="p">))</span> <span class="o">&amp;</span>
<a href="#__codelineno-8-31" id="__codelineno-8-31" name="__codelineno-8-31"></a>    <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">'date_of_birth'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s1">'2018-07-21'</span><span class="p">))</span>
<a href="#__codelineno-8-32" id="__codelineno-8-32" name="__codelineno-8-32"></a><span class="p">)</span>
</code></pre></div> <h2 id="array-operations">Array Operations<a class="headerlink" href="#array-operations" title="Permanent link">¶</a></h2> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># Column Array - F.array(*cols)</span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'full_name'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">'fname'</span><span class="p">,</span> <span class="s1">'lname'</span><span class="p">))</span>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="c1"># Empty Array - F.array(*cols)</span>
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'empty_array_column'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="c1"># Array Size/Length – F.size(col)</span>
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'array_length'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="s1">'my_array'</span><span class="p">))</span>
<a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a>
<a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="c1"># Flatten Array – F.flatten(col)</span>
<a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'flattened'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">'my_array'</span><span class="p">))</span>
<a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a>
<a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="c1"># Unique/Distinct Elements – F.array_distinct(col)</span>
<a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'unique_elements'</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">array_distinct</span><span class="p">(</span><span class="s1">'my_array'</span><span class="p">))</span>
</code></pre></div> <h2 id="aggregation-operations">Aggregation Operations<a class="headerlink" href="#aggregation-operations" title="Permanent link">¶</a></h2> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># Row Count:                F.count()</span>
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="c1"># Sum of Rows in Group:     F.sum(*cols)</span>
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="c1"># Mean of Rows in Group:    F.mean(*cols)</span>
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="c1"># Max of Rows in Group:     F.max(*cols)</span>
<a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="c1"># Min of Rows in Group:     F.min(*cols)</span>
<a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="c1"># First Row in Group:       F.alias(*cols)</span>
<a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s1">'gender'</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s1">'age'</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'max_age_by_gender'</span><span class="p">))</span>
<a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a>
<a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="c1"># Collect a Set of all Rows in Group:       F.collect_set(col)</span>
<a href="#__codelineno-10-10" id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="c1"># Collect a List of all Rows in Group:      F.collect_list(col)</span>
<a href="#__codelineno-10-11" id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s1">'age'</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">collect_set</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'person_names'</span><span class="p">))</span>
<a href="#__codelineno-10-12" id="__codelineno-10-12" name="__codelineno-10-12"></a>
<a href="#__codelineno-10-13" id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="c1"># Just take the lastest row for each combination (Window Functions)</span>
<a href="#__codelineno-10-14" id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">Window</span> <span class="k">as</span> <span class="n">W</span>
<a href="#__codelineno-10-15" id="__codelineno-10-15" name="__codelineno-10-15"></a>
<a href="#__codelineno-10-16" id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="n">window</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">,</span> <span class="s2">"last_name"</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">desc</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span>
<a href="#__codelineno-10-17" id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"row_number"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
<a href="#__codelineno-10-18" id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"row_number"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<a href="#__codelineno-10-19" id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"row_number"</span><span class="p">)</span>
</code></pre></div> <h2 id="advanced-operations">Advanced Operations<a class="headerlink" href="#advanced-operations" title="Permanent link">¶</a></h2> <h4 id="repartitioning">Repartitioning<a class="headerlink" href="#repartitioning" title="Permanent link">¶</a></h4> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># Repartition – df.repartition(num_output_partitions)</span>
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div> <h4 id="udfs-user-defined-functions">UDFs (User Defined Functions<a class="headerlink" href="#udfs-user-defined-functions" title="Permanent link">¶</a></h4> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1"># Multiply each row's age column by two</span>
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="n">times_two_udf</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="n">times_two_udf</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age</span><span class="p">))</span>
<a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a>
<a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="c1"># Randomly choose a value to use as a row's name</span>
<a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="kn">import</span> <span class="nn">random</span>
<a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a>
<a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="n">random_name_udf</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">'Bob'</span><span class="p">,</span> <span class="s1">'Tom'</span><span class="p">,</span> <span class="s1">'Amy'</span><span class="p">,</span> <span class="s1">'Jenna'</span><span class="p">]))</span>
<a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="n">random_name_udf</span><span class="p">())</span>
</code></pre></div> </article> </div> </div> </main> <footer class="md-footer"> <nav aria-label="Footer" class="md-footer__inner md-grid"> <a aria-label="Previous: 📝 PySpark Quickstart" class="md-footer__link md-footer__link--prev" href="../pyspark-dataframe-api/" rel="prev"> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </div> <div class="md-footer__title"> <div class="md-ellipsis"> <span class="md-footer__direction"> Previous </span> 📝 PySpark Quickstart </div> </div> </a> <a aria-label="Next: ✨ Creating tables in PySpark Azure" class="md-footer__link md-footer__link--next" href="../pyspark-azure-tables/" rel="next"> <div class="md-footer__title"> <div class="md-ellipsis"> <span class="md-footer__direction"> Next </span> ✨ Creating tables in PySpark Azure </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> Made with <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank"> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <script id="__config" type="application/json">{"base": "../..", "features": ["search.highlight", "search.suggest", "header.autohide"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src="../../assets/javascripts/bundle.8492ddcf.min.js"></script> <script src="../../assets/javascripts/extra.js"></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body> </html>