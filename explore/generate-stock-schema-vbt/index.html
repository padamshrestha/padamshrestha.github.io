<!DOCTYPE html>
<html class="no-js" lang="en"> <head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><meta content="Notes from day to day tasks" name="description"/><meta content="Padam Shrestha" name="author"/><link href="../../assets/images/favicon.png" rel="icon"/><meta content="mkdocs-1.5.3, mkdocs-material-8.5.7" name="generator"/><title>Stock and Option Schema and strategies with VBT - Blog</title><link href="../../assets/stylesheets/main.20d9efc8.min.css" rel="stylesheet"/><link href="../../assets/stylesheets/palette.cbb835fc.min.css" rel="stylesheet"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href="../../assets/stylesheets/extra.css" rel="stylesheet"/><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-08DR4DTC9K"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-08DR4DTC9K",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-08DR4DTC9K",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gdesc-inner { font-size: 0.75rem; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                </style><script src="../../assets/javascripts/glightbox.min.js"></script></head> <body data-md-color-accent="indigo" data-md-color-primary="light-blue" data-md-color-scheme="slate" dir="ltr"> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/> <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a class="md-skip" href="#stock-and-option-schema-and-strategies-with-vbt"> Skip to content </a> </div> <div data-md-component="announce"> </div> <header class="md-header" data-md-component="header"> <nav aria-label="Header" class="md-header__inner md-grid"> <a aria-label="Blog" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Blog"> <img alt="logo" src="../../assets/images/blog_logo.png"/> </a> <label class="md-header__button md-icon" for="__drawer"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> Blog </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> Stock and Option Schema and strategies with VBT </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="light-blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg> </label> <input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="red" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_2" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg> </label> </form> <label class="md-header__button md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/> <label class="md-search__icon md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label="Search" class="md-search__options"> <button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> <div class="md-search__suggest" data-md-component="search-suggest"></div> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" data-md-scrollfix=""> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list"></ol> </div> </div> </div> </div> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a aria-label="Blog" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Blog"> <img alt="logo" src="../../assets/images/blog_logo.png"/> </a> Blog </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../.."> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/> <label class="md-nav__link" for="__nav_2"> Synapse <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Synapse" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_2"> <span class="md-nav__icon md-icon"></span> Synapse </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../synapse/build-dev-pyspark-cluster/"> üê≥ Build Development Spark cluster - PySpark, Delta Lake </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../synapse/pyspark-dataframe-api/"> üìù PySpark Quickstart </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../synapse/pyspark-cheat-sheet/"> üìÑ PySpark Cheat Sheet </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../synapse/pyspark-azure-tables/"> ‚ú® Creating tables in PySpark Azure </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../spark-delta-partition/"> Creating partition in delta lake with spark </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../generate-stock-schema-delta-api/"> Design stock and option schema and provide fast api to access using spark delta </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../synapse/introduction/"> üìò Synapse Introduction </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../synapse/problem-solutions/"> üîì Synapse / PySpark problem and solutions </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../data-dcitionary-pipeline/"> üß∫ Data dictionary for metadata driven Synapse pipeline </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../synapse/pyspark-courses/"> üîÖ Courses and Tutorials </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../synapse/links/"> üîó Synapse links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/> <label class="md-nav__link" for="__nav_3"> Python <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Python" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_3"> <span class="md-nav__icon md-icon"></span> Python </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../python/python-basics/"> üêç Python Basics </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../python/create-python-package/"> üì¶ Create Custom Python Package </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../python/python-courses/"> üìô Courses and Tutorials </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../python/links/"> üîó Python links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/> <label class="md-nav__link" for="__nav_4"> Dotnet <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Dotnet" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_4"> <span class="md-nav__icon md-icon"></span> Dotnet </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-7/"> What's new in C# 7.0 through C# 7.3 </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-8/"> What's new in C# 8.0 </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-9/"> What's new in C# 9.0 - C# Guide </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-10/"> What's new in C# 10 - C# Guide </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../csharp/csharp-11/"> What's new in C# 11 - C# Guide </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/> <label class="md-nav__link" for="__nav_5"> Microservices <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Microservices" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_5"> <span class="md-nav__icon md-icon"></span> Microservices </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../microservices/grafana-dashboards/"> Grafana Dashboards </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../microservices/azure-function-dapr/"> Azure function with Dapr to create event-driven, distributed application </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../microservices/dapr-resources/"> Resources </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../microservices/links/"> üîó Dapr links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/> <label class="md-nav__link" for="__nav_6"> Serverless <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Serverless" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_6"> <span class="md-nav__icon md-icon"></span> Serverless </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../serverless/links/"> üîó Azure Serverless links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" id="__nav_7" type="checkbox"/> <label class="md-nav__link" for="__nav_7"> Azure <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Azure" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_7"> <span class="md-nav__icon md-icon"></span> Azure </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/azure-resource-graph-explorer/"> Write query using Azure Resource Graph Explorer </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/azure-keyboard-shortcuts/"> Azure Keyboard Shortcuts in Azure Portal </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/azure-service-fabric/"> Introduction to Azure Service Fabric </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/starting-azure-service-fabric/"> Starting Azure Service Fabric </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../azure/links/"> üîó Azure links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" id="__nav_8" type="checkbox"/> <label class="md-nav__link" for="__nav_8"> Spark <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Spark" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_8"> <span class="md-nav__icon md-icon"></span> Spark </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/jupyter-pyspark-docker/"> Run Jupyter for Pyspark on Docker </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/dotnet-spark-learning/"> Spark Machine Learning </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/dotnet-spark-docker/"> Run and Debug Dotnet Spark application on Docker </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/dotnet-spark-ubuntu/"> Install Dotnet Spark on Ubuntu </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/dotnet-spark-docker-ubuntu/"> Running Dotnet Spark applications on Ubuntu Continer </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/install-docker-ubuntu2004/"> Install Docker on Ubuntu 20.04 LTS and Dotnet Spark on Docker </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/python-learning/"> Learning Python </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../spark/links/"> üîó Spark links </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" id="__nav_9" type="checkbox"/> <label class="md-nav__link" for="__nav_9"> Kusto <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Kusto" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_9"> <span class="md-nav__icon md-icon"></span> Kusto </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/kusto-overview/"> Kusto Query Language (KQL) </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/dynamic-365-hcm-kusto/"> Troubleshoot using Kusto </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" id="__nav_10" type="checkbox"/> <label class="md-nav__link" for="__nav_10"> Angular <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Angular" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_10"> <span class="md-nav__icon md-icon"></span> Angular </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../home/deploy-angular-app-to-github-io-pages/"> Deploy Angular app to github.io pages </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" id="__nav_11" type="checkbox"/> <label class="md-nav__link" for="__nav_11"> Tools and Tricks <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Tools and Tricks" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_11"> <span class="md-nav__icon md-icon"></span> Tools and Tricks </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../fastapi-uvicorn/"> Configure Fast API with Uvicorn in Dockerfile </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/limited_access_pat_token/"> Create Git PAT token with limited access. </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/multiple-remote-git/"> Multiple remote git configuration for repository </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/chocolatey/"> Install and manage applications using Chocolatey </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/keyboard-shortcuts/"> Keyboard shortcuts for everyday tasks </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/error-solutions/"> Everyday error and fixes </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/certificates/"> Searching and Installing Certificates </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/install-vscode-ubuntu/"> Install VS Code on Ubuntu </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/install-brave-ubuntu2004/"> Install Brave browser on Ubuntu 20.04 LTS </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/useful-online-tools/"> ‚öí Useful online tools </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/helpful-links/"> üîó Helpful links </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/nuget/"> Nuget Package Manger </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/docker/"> üê≥ Installing and Running Docker in WSL with VS Code </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/dotnetcore-azurefunction-wsl/"> Install dotnet core 3.1 and azure-functions-core-tools on WSL </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/configure-publish-mkdocs-github/"> üìö Configure Mkdocs and Auto deploy to Github.io </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/rename-dotnet-3-6/"> Migrate Dotnet Core 3.1 to DotNet 6.0 </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/git-help/"> Git </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/install-dotnet-sdk-armx64/"> Install dotnet skd on Mac m1 armx64 </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/windows-tricks/"> Windows tricks </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tools/linux-commands/"> Useful linux commands </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" id="__nav_12" type="checkbox"/> <label class="md-nav__link" for="__nav_12"> Courses, Projects, Tutorials, Blogs <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Courses, Projects, Tutorials, Blogs" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_12"> <span class="md-nav__icon md-icon"></span> Courses, Projects, Tutorials, Blogs </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../courses-projects/coursera/"> Coursera Courses </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../courses-projects/github_project/"> Github repo and projects </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" id="__nav_13" type="checkbox"/> <label class="md-nav__link" for="__nav_13"> Finance <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Finance" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_13"> <span class="md-nav__icon md-icon"></span> Finance </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../finance/use_of_ft/"> Fourier Transform in Price </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_14" id="__nav_14" type="checkbox"/> <label class="md-nav__link" for="__nav_14"> Random <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Random" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_14"> <span class="md-nav__icon md-icon"></span> Random </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../random/links/"> üîó Random useful links </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tags/"> Tags </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#generate-schema-for-stocks-and-options-using-pyspark-with-delta-lake-including-charges"> Generate schema for stocks and options using pyspark with delta lake including charges </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#create-ichimoku-strategy-using-vectorbt"> Create ichimoku strategy using vectorbt </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#generate-signal-to-buy-when-close-price-above-chiku-span-and-above-ichimoku-cloudu-and-sell-signal-when-close-price-is-below-chiku-span-and-below-ichimoku-cloud"> Generate signal to buy when close price above chiku span and above ichimoku cloudu and sell signal when close price is below chiku span and below ichimoku cloud </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#generate-same-strategy-using-vectorbtpro"> Generate same strategy using vectorbtpro </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#strategy-to-generate-signal-for-unusual-volume-for-the-assets"> Strategy to generate signal for unusual volume for the assets </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#backtest-both-strategies-using-vectorbt"> Backtest both strategies using vectorbt </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#generate-alerts-for-signals"> Generate alerts for signals </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimize-performance-of-strategies-using-numba"> Optimize performance of strategies using numba </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#create-strategies-and-alerts-in-pyspark"> Create strategies and alerts in pyspark </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <h1 id="stock-and-option-schema-and-strategies-with-vbt">Stock and Option Schema and strategies with VBT<a class="headerlink" href="#stock-and-option-schema-and-strategies-with-vbt" title="Permanent link">¬∂</a></h1> <h3 id="generate-schema-for-stocks-and-options-using-pyspark-with-delta-lake-including-charges">Generate schema for stocks and options using pyspark with delta lake including charges<a class="headerlink" href="#generate-schema-for-stocks-and-options-using-pyspark-with-delta-lake-including-charges" title="Permanent link">¬∂</a></h3> <p>Here is an example schema for a stocks and options table using PySpark and Delta Lake:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StructType</span><span class="p">,</span> <span class="n">StructField</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">,</span> <span class="n">IntegerType</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="n">StructField</span><span class="p">(</span><span class="s2">"symbol"</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="n">StructField</span><span class="p">(</span><span class="s2">"timestamp"</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="n">StructField</span><span class="p">(</span><span class="s2">"price"</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="n">StructField</span><span class="p">(</span><span class="s2">"volume"</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="n">StructField</span><span class="p">(</span><span class="s2">"strike_price"</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a>    <span class="n">StructField</span><span class="p">(</span><span class="s2">"expiration_date"</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="n">StructField</span><span class="p">(</span><span class="s2">"option_type"</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="n">StructField</span><span class="p">(</span><span class="s2">"charge"</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="p">])</span>
</code></pre></div> <p>This schema includes the following fields:</p> <ul> <li>"symbol": a string representing the stock or option symbol</li> <li>"timestamp": a string representing the timestamp of the stock or option data</li> <li>"price": a double representing the price of the stock or option</li> <li>"volume": an integer representing the volume of the stock or option</li> <li>"strike_price": a double representing the strike price of the option</li> <li>"expiration_date": a string representing the expiration date of the option</li> <li>"option_type": a string representing the option type (e.g. "call" or "put")</li> <li>"charge": a double representing any charges associated with the stock or option</li> </ul> <p>You can use this schema to create a Delta Lake table using the create method, and then read and write data to the table using PySpark DataFrames.</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">from</span> <span class="nn">delta.tables</span> <span class="kn">import</span> <span class="o">*</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="c1"># create the delta table</span>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="p">(</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"delta"</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">"path/to/table"</span><span class="p">)</span>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>    <span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"delta"</span><span class="p">)</span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>    <span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s2">"overwrite"</span><span class="p">)</span>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>    <span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">"path/to/table"</span><span class="p">))</span>
</code></pre></div> <p>Please note that this is a basic example, you should adapt this schema to your specific use case, and that the path/to/table is a example and should be replaced by the actual path to your table.</p> <h3 id="create-ichimoku-strategy-using-vectorbt">Create ichimoku strategy using vectorbt<a class="headerlink" href="#create-ichimoku-strategy-using-vectorbt" title="Permanent link">¬∂</a></h3> <p>Here is an example of how to create an Ichimoku strategy using the vectorbt library:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kn">import</span> <span class="nn">vectorbt</span> <span class="k">as</span> <span class="nn">vbt</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="c1"># Create the Ichimoku indicators</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="n">indicator_df</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">indicators</span><span class="o">.</span><span class="n">Ichimoku</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">high_col</span><span class="o">=</span><span class="s1">'high'</span><span class="p">,</span> <span class="n">low_col</span><span class="o">=</span><span class="s1">'low'</span><span class="p">,</span> <span class="n">close_col</span><span class="o">=</span><span class="s1">'close'</span><span class="p">)</span>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="c1"># Create the strategy</span>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="n">strategy</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="n">indicator_df</span><span class="p">,</span> 
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>                       <span class="n">entry_rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">tenkan_sen_cross_kijun_sen</span><span class="p">,</span>
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a>                       <span class="n">exit_rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">chikou_span_cross_price</span><span class="p">)</span>
<a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a>
<a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="c1"># Run the strategy</span>
<a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="n">results_df</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div> <p>In this example, the df variable is a DataFrame containing the historical high, low, and close prices for the stock or instrument you are trading.</p> <p>The Ichimoku indicators are calculated using the vbt.indicators.Ichimoku.run() method and assigned to the indicator_df variable.</p> <p>The strategy is created using the vbt.Strategy() class and passed the indicator_df variable. The entry_rule is set to the tenkan_sen crossing the kijun_sen and exit_rule is set to chikou_span crossing the price.</p> <p>The run() method is then called on the strategy and passed the df variable, which returns a DataFrame containing the results of the strategy, such as the entry and exit signals, PnL, and performance metrics.</p> <p>Please note that this is a basic example and that you should adapt it to your specific use case, and that the column names in your dataframe may vary than the one in this example.</p> <h3 id="generate-signal-to-buy-when-close-price-above-chiku-span-and-above-ichimoku-cloudu-and-sell-signal-when-close-price-is-below-chiku-span-and-below-ichimoku-cloud">Generate signal to buy when close price above chiku span and above ichimoku cloudu and sell signal when close price is below chiku span and below ichimoku cloud<a class="headerlink" href="#generate-signal-to-buy-when-close-price-above-chiku-span-and-above-ichimoku-cloudu-and-sell-signal-when-close-price-is-below-chiku-span-and-below-ichimoku-cloud" title="Permanent link">¬∂</a></h3> <p>Here is an example of how to generate buy and sell signals using the vectorbt library based on the close price being above the Chikou Span and above the Ichimoku Cloud, and below the Chikou Span and below the Ichimoku Cloud respectively:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kn">import</span> <span class="nn">vectorbt</span> <span class="k">as</span> <span class="nn">vbt</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="c1"># Create the Ichimoku indicators</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="n">indicator_df</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">indicators</span><span class="o">.</span><span class="n">Ichimoku</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">high_col</span><span class="o">=</span><span class="s1">'high'</span><span class="p">,</span> <span class="n">low_col</span><span class="o">=</span><span class="s1">'low'</span><span class="p">,</span> <span class="n">close_col</span><span class="o">=</span><span class="s1">'close'</span><span class="p">)</span>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="c1"># Create the buy signal</span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="n">buy_signal</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'close'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">indicator_df</span><span class="p">[</span><span class="s1">'chikou_span'</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'close'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">indicator_df</span><span class="p">[</span><span class="s1">'senkou_span_a'</span><span class="p">])</span>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="c1"># Create the sell signal</span>
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="n">sell_signal</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'close'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">indicator_df</span><span class="p">[</span><span class="s1">'chikou_span'</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'close'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">indicator_df</span><span class="p">[</span><span class="s1">'senkou_span_a'</span><span class="p">])</span>
<a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>
<a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="c1"># Add the signals to the DataFrame</span>
<a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="n">df</span><span class="p">[</span><span class="s1">'buy_signal'</span><span class="p">]</span> <span class="o">=</span> <span class="n">buy_signal</span>
<a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="n">df</span><span class="p">[</span><span class="s1">'sell_signal'</span><span class="p">]</span> <span class="o">=</span> <span class="n">sell_signal</span>
</code></pre></div> <p>In this example, the df variable is a DataFrame containing the historical high, low, and close prices for the stock or instrument you are trading.</p> <p>The Ichimoku indicators are calculated using the vbt.indicators.Ichimoku.run() method and assigned to the indicator_df variable.</p> <p>The buy signal is generated by checking whether the close price is greater than the Chikou Span and greater than the Senkou Span A (which forms the top of the Ichimoku cloud). The sell signal is generated by checking whether the close price is less than the Chikou Span and less than the Senkou Span A.</p> <p>The buy and sell signals are added as new columns to the DataFrame and can be used to make trading decisions.</p> <p>Please note that this is a basic example and that you should adapt it to your specific use case, and that the column names in your dataframe may vary than the one in this example.</p> <h3 id="generate-same-strategy-using-vectorbtpro">Generate same strategy using vectorbtpro<a class="headerlink" href="#generate-same-strategy-using-vectorbtpro" title="Permanent link">¬∂</a></h3> <p>Here is an example of how to generate the same buy and sell signals using the vectorbtpro library:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kn">import</span> <span class="nn">vectorbt</span> <span class="k">as</span> <span class="nn">vbt</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="kn">import</span> <span class="nn">vectorbt.signals</span> <span class="k">as</span> <span class="nn">signals</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="c1"># Create the Ichimoku indicators</span>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="n">indicator_df</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">indicators</span><span class="o">.</span><span class="n">Ichimoku</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">high_col</span><span class="o">=</span><span class="s1">'high'</span><span class="p">,</span> <span class="n">low_col</span><span class="o">=</span><span class="s1">'low'</span><span class="p">,</span> <span class="n">close_col</span><span class="o">=</span><span class="s1">'close'</span><span class="p">)</span>
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="c1"># Create the buy signal</span>
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="n">buy_signal</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">CrossSignal</span><span class="o">.</span><span class="n">from_boolean</span><span class="p">(</span>
<a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a>    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'close'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">indicator_df</span><span class="p">[</span><span class="s1">'chikou_span'</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'close'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">indicator_df</span><span class="p">[</span><span class="s1">'senkou_span_a'</span><span class="p">]),</span>
<a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a>    <span class="n">win_type</span><span class="o">=</span><span class="s1">'expanding'</span><span class="p">,</span>
<a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a>    <span class="n">center</span><span class="o">=</span><span class="kc">True</span>
<a href="#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="p">)</span>
<a href="#__codelineno-4-13" id="__codelineno-4-13" name="__codelineno-4-13"></a>
<a href="#__codelineno-4-14" id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="c1"># Create the sell signal</span>
<a href="#__codelineno-4-15" id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="n">sell_signal</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">CrossSignal</span><span class="o">.</span><span class="n">from_boolean</span><span class="p">(</span>
<a href="#__codelineno-4-16" id="__codelineno-4-16" name="__codelineno-4-16"></a>    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'close'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">indicator_df</span><span class="p">[</span><span class="s1">'chikou_span'</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'close'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">indicator_df</span><span class="p">[</span><span class="s1">'senkou_span_a'</span><span class="p">]),</span>
<a href="#__codelineno-4-17" id="__codelineno-4-17" name="__codelineno-4-17"></a>    <span class="n">win_type</span><span class="o">=</span><span class="s1">'expanding'</span><span class="p">,</span>
<a href="#__codelineno-4-18" id="__codelineno-4-18" name="__codelineno-4-18"></a>    <span class="n">center</span><span class="o">=</span><span class="kc">True</span>
<a href="#__codelineno-4-19" id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="p">)</span>
<a href="#__codelineno-4-20" id="__codelineno-4-20" name="__codelineno-4-20"></a>
<a href="#__codelineno-4-21" id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="c1"># Run the strategy</span>
<a href="#__codelineno-4-22" id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="n">strategy</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">entry_signal</span><span class="o">=</span><span class="n">buy_signal</span><span class="p">,</span> <span class="n">exit_signal</span><span class="o">=</span><span class="n">sell_signal</span><span class="p">)</span>
<a href="#__codelineno-4-23" id="__codelineno-4-23" name="__codelineno-4-23"></a><span class="n">results_df</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div> <p>In this example, the df variable is a DataFrame containing the historical high, low, and close prices for the stock or instrument you are trading.</p> <p>The Ichimoku indicators are calculated using the vbt.indicators.Ichimoku.run() method and assigned to the indicator_df variable.</p> <p>The buy and sell signals are generated by creating instances of the CrossSignal class from the boolean conditions that check if close price is above chiku span and above ichimoku cloud or below chiku span and below ichimoku cloud. The win_type is set to 'expanding' and center=True so that the signal will be generated when the condition is met for the first time and will be held until the condition is no longer met.</p> <p>The signals are passed to the vbt.Strategy class as the entry_signal and exit_signal, respectively. The run() method is then called on the strategy, which returns a DataFrame containing the results of the strategy, such as the entry and exit signals, PnL, and performance metrics.</p> <p>Please note that this is a basic example and that you should adapt it to your specific use case, and that the column names in your dataframe may vary than the one in this example.</p> <h3 id="strategy-to-generate-signal-for-unusual-volume-for-the-assets">Strategy to generate signal for unusual volume for the assets<a class="headerlink" href="#strategy-to-generate-signal-for-unusual-volume-for-the-assets" title="Permanent link">¬∂</a></h3> <p>Here is an example of how to generate a signal for unusual volume using the vectorbt library:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">import</span> <span class="nn">vectorbt</span> <span class="k">as</span> <span class="nn">vbt</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="c1"># Compute the average volume over a rolling window</span>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="n">mean_volume</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'volume'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="c1"># Compute the standard deviation of volume over a rolling window</span>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="n">std_volume</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'volume'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a>
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="c1"># Create the signal</span>
<a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="n">unusual_volume_signal</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'volume'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">mean_volume</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">std_volume</span>
<a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>
<a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="c1"># Add the signal to the DataFrame</span>
<a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="n">df</span><span class="p">[</span><span class="s1">'unusual_volume_signal'</span><span class="p">]</span> <span class="o">=</span> <span class="n">unusual_volume_signal</span>
</code></pre></div> <p>In this example, the df variable is a DataFrame containing the historical volume and other relevant data for the assets you are trading.</p> <p>The average volume is computed over a rolling window of 10 days using the rolling() method and the mean() function, and assigned to the mean_volume variable. Similarly, the standard deviation of volume is computed over a rolling window of 10 days using the rolling() method and the std() function, and assigned to the std_volume variable.</p> <p>The signal for unusual volume is generated by checking whether the volume is greater than the average volume plus 2 times the standard deviation of volume.</p> <p>The signal is added as a new column to the DataFrame and can be used to make trading decisions.</p> <p>Please note that this is a basic example and that you should adapt it to your specific use case, and that the window size and the threshold for unusual volume might vary depending on the assets and the market conditions. Also, the column names in your dataframe may vary than the one in this example.</p> <h3 id="backtest-both-strategies-using-vectorbt">Backtest both strategies using vectorbt<a class="headerlink" href="#backtest-both-strategies-using-vectorbt" title="Permanent link">¬∂</a></h3> <p>Here is an example of how to backtest both the Ichimoku strategy and the unusual volume strategy using the vectorbt library:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">import</span> <span class="nn">vectorbt</span> <span class="k">as</span> <span class="nn">vbt</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="c1"># Create the Ichimoku indicators</span>
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="n">indicator_df</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">indicators</span><span class="o">.</span><span class="n">Ichimoku</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">high_col</span><span class="o">=</span><span class="s1">'high'</span><span class="p">,</span> <span class="n">low_col</span><span class="o">=</span><span class="s1">'low'</span><span class="p">,</span> <span class="n">close_col</span><span class="o">=</span><span class="s1">'close'</span><span class="p">)</span>
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a>
<a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="c1"># Create the Ichimoku strategy</span>
<a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="n">ichimoku_strategy</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="n">indicator_df</span><span class="p">,</span>
<a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a>                                 <span class="n">entry_rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">tenkan_sen_cross_kijun_sen</span><span class="p">,</span>
<a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a>                                 <span class="n">exit_rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">chikou_span_cross_price</span><span class="p">)</span>
<a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a>
<a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="c1"># Backtest the Ichimoku strategy</span>
<a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="n">ichimoku_results_df</span> <span class="o">=</span> <span class="n">ichimoku_strategy</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a>
<a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="c1"># Compute the average volume over a rolling window</span>
<a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="n">mean_volume</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'volume'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a>
<a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="c1"># Compute the standard deviation of volume over a rolling window</span>
<a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="n">std_volume</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'volume'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a>
<a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="c1"># Create the unusual volume signal</span>
<a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="n">unusual_volume_signal</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'volume'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">mean_volume</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">std_volume</span>
<a href="#__codelineno-6-22" id="__codelineno-6-22" name="__codelineno-6-22"></a>
<a href="#__codelineno-6-23" id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="c1"># Create the unusual volume strategy</span>
<a href="#__codelineno-6-24" id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="n">unusual_volume_strategy</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">entry_signal</span><span class="o">=</span><span class="n">unusual_volume_signal</span><span class="p">)</span>
<a href="#__codelineno-6-25" id="__codelineno-6-25" name="__codelineno-6-25"></a>
<a href="#__codelineno-6-26" id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="c1"># Backtest the unusual volume strategy</span>
<a href="#__codelineno-6-27" id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="n">unusual_volume_results_df</span> <span class="o">=</span> <span class="n">unusual_volume_strategy</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div> <p>In this example, the df variable is a DataFrame containing the historical high, low, and close prices for the stock or instrument you are trading.</p> <p>The Ichimoku indicators are calculated using the vbt.indicators.Ichimoku.run() method and assigned to the indicator_df variable.</p> <p>A vbt.Strategy object is then created using the indicator_df and the entry and exit rules defined as lambda functions. Then the run() method is called on the strategy which returns the DataFrame of the results.</p> <p>The signal for unusual volume is generated by checking whether the volume is greater than the average volume plus 2 times the standard deviation of volume.</p> <p>A vbt.Strategy object is then created using the DataFrame and the entry signal for unusual volume. Then the run() method is called on the strategy which returns the DataFrame of the results.</p> <p>You can then use the results DataFrames to analyze the performance of the strategies, such as the PnL, the number of trades, the win rate, the maximum drawdown, etc.</p> <p>Please note that this is a basic example and that you should adapt it to your specific use case, and that the window size and the threshold for unusual volume might vary depending on the assets and the market conditions. Also, the column names in your dataframe may vary than the one in this example.</p> <h3 id="generate-alerts-for-signals">Generate alerts for signals<a class="headerlink" href="#generate-alerts-for-signals" title="Permanent link">¬∂</a></h3> <p>Once you have generated the signals, you can use the vectorbt library to create alerts based on them. Here is an example of how to create alerts for the Ichimoku strategy and the unusual volume strategy:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kn">import</span> <span class="nn">vectorbt</span> <span class="k">as</span> <span class="nn">vbt</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="c1"># Create the Ichimoku indicators</span>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="n">indicator_df</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">indicators</span><span class="o">.</span><span class="n">Ichimoku</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">high_col</span><span class="o">=</span><span class="s1">'high'</span><span class="p">,</span> <span class="n">low_col</span><span class="o">=</span><span class="s1">'low'</span><span class="p">,</span> <span class="n">close_col</span><span class="o">=</span><span class="s1">'close'</span><span class="p">)</span>
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>
<a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="c1"># Create the Ichimoku strategy</span>
<a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="n">ichimoku_strategy</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="n">indicator_df</span><span class="p">,</span>
<a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a>                                 <span class="n">entry_rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">tenkan_sen_cross_kijun_sen</span><span class="p">,</span>
<a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a>                                 <span class="n">exit_rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">chikou_span_cross_price</span><span class="p">)</span>
<a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a>
<a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="c1"># Backtest the Ichimoku strategy</span>
<a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="n">ichimoku_results_df</span> <span class="o">=</span> <span class="n">ichimoku_strategy</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a>
<a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="c1"># Create an alert for the Ichimoku strategy</span>
<a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="n">ichimoku_alert</span> <span class="o">=</span> <span class="n">ichimoku_strategy</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">for_signals</span><span class="p">(</span>
<a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a>    <span class="s1">'entry'</span><span class="p">,</span>
<a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a>    <span class="n">send_alert</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Ichimoku strategy: Buy signal at </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="p">)</span>
<a href="#__codelineno-7-19" id="__codelineno-7-19" name="__codelineno-7-19"></a>
<a href="#__codelineno-7-20" id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="c1"># Compute the average volume over a rolling window</span>
<a href="#__codelineno-7-21" id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="n">mean_volume</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'volume'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a href="#__codelineno-7-22" id="__codelineno-7-22" name="__codelineno-7-22"></a>
<a href="#__codelineno-7-23" id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="c1"># Compute the standard deviation of volume over a rolling window</span>
<a href="#__codelineno-7-24" id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="n">std_volume</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'volume'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<a href="#__codelineno-7-25" id="__codelineno-7-25" name="__codelineno-7-25"></a>
<a href="#__codelineno-7-26" id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="c1"># Create the unusual volume signal</span>
<a href="#__codelineno-7-27" id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="n">unusual_volume_signal</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'volume'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">mean_volume</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">std_volume</span>
<a href="#__codelineno-7-28" id="__codelineno-7-28" name="__codelineno-7-28"></a>
<a href="#__codelineno-7-29" id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="c1"># Create the unusual volume strategy</span>
<a href="#__codelineno-7-30" id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="n">unusual_volume_strategy</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">entry_signal</span><span class="o">=</span><span class="n">unusual_volume_signal</span><span class="p">)</span>
<a href="#__codelineno-7-31" id="__codelineno-7-31" name="__codelineno-7-31"></a>
<a href="#__codelineno-7-32" id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="c1"># Backtest the unusual volume strategy</span>
<a href="#__codelineno-7-33" id="__codelineno-7-33" name="__codelineno-7-33"></a><span class="n">unusual_volume_results_df</span> <span class="o">=</span> <span class="n">unusual_volume_strategy</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<a href="#__codelineno-7-34" id="__codelineno-7-34" name="__codelineno-7-34"></a>
<a href="#__codelineno-7-35" id="__codelineno-7-35" name="__codelineno-7-35"></a><span class="c1"># Create an alert for the unusual volume strategy</span>
<a href="#__codelineno-7-36" id="__codelineno-7-36" name="__codelineno-7-36"></a><span class="n">unusual_volume_alert</span> <span class="o">=</span> <span class="n">unusual_volume_strategy</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">for_signals</span><span class="p">(</span>
<a href="#__codelineno-7-37" id="__codelineno-7-37" name="__codelineno-7-37"></a>    <span class="s1">'entry'</span><span class="p">,</span>
<a href="#__codelineno-7-38" id="__codelineno-7-38" name="__codelineno-7-38"></a>    <span class="n">send_alert</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Unusual volume strategy: Buy signal at </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a href="#__codelineno-7-39" id="__codelineno-7-39" name="__codelineno-7-39"></a><span class="p">)</span>
</code></pre></div> <p>In this example, the vectorbt library is used to create alerts for each of the two strategies. The alerts.for_signals() method is called on the strategy object, which accepts the signal type ('entry' in this case) and a function send_alert that will be called when the signal is triggered.</p> <p>The function send_alert is passed a lambda function that prints a message to the console when the signal is triggered. This can be replaced with any other method of alerting, such as sending an email or a text message, or updating a database.</p> <p>Please note that this is a basic example and that you should adapt it to your specific use case and that the column names in your dataframe may vary than the one in this example.</p> <h3 id="optimize-performance-of-strategies-using-numba">Optimize performance of strategies using numba<a class="headerlink" href="#optimize-performance-of-strategies-using-numba" title="Permanent link">¬∂</a></h3> <p>You can use the numba library to optimize the performance of your strategies built using vectorbt. numba is a just-in-time (JIT) compiler that can be used to speed up the execution of Python code. Here is an example of how to optimize the performance of the Ichimoku strategy using numba:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">import</span> <span class="nn">numba</span> <span class="k">as</span> <span class="nn">nb</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kn">import</span> <span class="nn">vectorbt</span> <span class="k">as</span> <span class="nn">vbt</span>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="c1"># Create the Ichimoku indicators</span>
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="n">indicator_df</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">indicators</span><span class="o">.</span><span class="n">Ichimoku</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">high_col</span><span class="o">=</span><span class="s1">'high'</span><span class="p">,</span> <span class="n">low_col</span><span class="o">=</span><span class="s1">'low'</span><span class="p">,</span> <span class="n">close_col</span><span class="o">=</span><span class="s1">'close'</span><span class="p">)</span>
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>
<a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="c1"># Create the Ichimoku strategy</span>
<a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span>
<a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="k">def</span> <span class="nf">ichimoku_strategy</span><span class="p">(</span><span class="n">indicator_df</span><span class="p">):</span>
<a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a>    <span class="n">entry_rule</span> <span class="o">=</span> <span class="n">indicator_df</span><span class="p">[</span><span class="s1">'tenkan_sen_cross_kijun_sen'</span><span class="p">]</span>
<a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a>    <span class="n">exit_rule</span> <span class="o">=</span> <span class="n">indicator_df</span><span class="p">[</span><span class="s1">'chikou_span_cross_price'</span><span class="p">]</span>
<a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a>    <span class="k">return</span> <span class="n">entry_rule</span><span class="p">,</span> <span class="n">exit_rule</span>
<a href="#__codelineno-8-13" id="__codelineno-8-13" name="__codelineno-8-13"></a>
<a href="#__codelineno-8-14" id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="n">ichimoku_strategy</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="n">indicator_df</span><span class="p">,</span> <span class="n">entry_rule</span><span class="o">=</span><span class="n">ichimoku_strategy</span><span class="p">)</span>
<a href="#__codelineno-8-15" id="__codelineno-8-15" name="__codelineno-8-15"></a>
<a href="#__codelineno-8-16" id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="c1"># Backtest the Ichimoku strategy</span>
<a href="#__codelineno-8-17" id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="n">ichimoku_results_df</span> <span class="o">=</span> <span class="n">ichimoku_strategy</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div> <p>In this example, the numba.njit decorator is used to optimize the performance of the ichimoku_strategy function. This function contains the entry and exit rules for the Ichimoku strategy.</p> <p>The <a class="magiclink magiclink-github magiclink-mention" href="https://github.com/nb" title="GitHub User: nb">@nb</a>.njit decorator tells numba to compile the function, which results in faster execution times. You can also use numba.jit decorator that will try to optimize the code, but it will not throw an error if it fails.</p> <p>You can use this approach to optimize any other part of your code that is computationally intensive.</p> <p>Please note that this is a basic example and that you should adapt it to your specific use case. Also, that numba optimization may not always be the best option, as it can have some overhead and the performance gains may be minimal for small data sets.</p> <h3 id="create-strategies-and-alerts-in-pyspark">Create strategies and alerts in pyspark<a class="headerlink" href="#create-strategies-and-alerts-in-pyspark" title="Permanent link">¬∂</a></h3> <p>Here is an example of how to create the Ichimoku strategy and the unusual volume strategy, as well as the associated alerts, using PySpark:</p> <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">when</span><span class="p">,</span> <span class="n">lead</span>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="c1"># Create a SparkSession</span>
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">"Ichimoku_Unusual_Volume"</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="c1"># Read the data into a DataFrame</span>
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">"path_to_data.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a>
<a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="c1"># Create the Ichimoku indicators</span>
<a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="n">indicator_df</span> <span class="o">=</span> <span class="n">vbt</span><span class="o">.</span><span class="n">indicators</span><span class="o">.</span><span class="n">Ichimoku</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">high_col</span><span class="o">=</span><span class="s1">'high'</span><span class="p">,</span> <span class="n">low_col</span><span class="o">=</span><span class="s1">'low'</span><span class="p">,</span> <span class="n">close_col</span><span class="o">=</span><span class="s1">'close'</span><span class="p">)</span>
<a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a>
<a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="c1"># Create the Ichimoku strategy</span>
<a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="n">ichimoku_strategy</span> <span class="o">=</span> <span class="n">indicator_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"buy_signal"</span><span class="p">,</span> <span class="n">when</span><span class="p">((</span><span class="n">col</span><span class="p">(</span><span class="s2">"tenkan_sen"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">col</span><span class="p">(</span><span class="s2">"kijun_sen"</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"close"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">col</span><span class="p">(</span><span class="s2">"senkou_span_a"</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a href="#__codelineno-9-15" id="__codelineno-9-15" name="__codelineno-9-15"></a>
<a href="#__codelineno-9-16" id="__codelineno-9-16" name="__codelineno-9-16"></a><span class="c1"># Create the alert for the Ichimoku strategy</span>
<a href="#__codelineno-9-17" id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="n">ichimoku_alert</span> <span class="o">=</span> <span class="n">ichimoku_strategy</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"buy_signal"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"timestamp"</span><span class="p">,</span> <span class="s2">"stock"</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a href="#__codelineno-9-18" id="__codelineno-9-18" name="__codelineno-9-18"></a>
<a href="#__codelineno-9-19" id="__codelineno-9-19" name="__codelineno-9-19"></a><span class="c1"># Compute the average volume over a rolling window</span>
<a href="#__codelineno-9-20" id="__codelineno-9-20" name="__codelineno-9-20"></a><span class="n">mean_volume</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">avg</span><span class="p">(</span><span class="s2">"volume"</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">"timestamp"</span><span class="p">)</span><span class="o">.</span><span class="n">rowsBetween</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"mean_volume"</span><span class="p">)</span>
<a href="#__codelineno-9-21" id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mean_volume</span><span class="p">,</span> <span class="s2">"timestamp"</span><span class="p">)</span>
<a href="#__codelineno-9-22" id="__codelineno-9-22" name="__codelineno-9-22"></a>
<a href="#__codelineno-9-23" id="__codelineno-9-23" name="__codelineno-9-23"></a><span class="c1"># Compute the standard deviation of volume over a rolling window</span>
<a href="#__codelineno-9-24" id="__codelineno-9-24" name="__codelineno-9-24"></a><span class="n">std_volume</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">stddev</span><span class="p">(</span><span class="s2">"volume"</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">"timestamp"</span><span class="p">)</span><span class="o">.</span><span class="n">rowsBetween</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"std_volume"</span><span class="p">)</span>
<a href="#__codelineno-9-25" id="__codelineno-9-25" name="__codelineno-9-25"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">std_volume</span><span class="p">,</span> <span class="s2">"timestamp"</span><span class="p">)</span>
<a href="#__codelineno-9-26" id="__codelineno-9-26" name="__codelineno-9-26"></a>
<a href="#__codelineno-9-27" id="__codelineno-9-27" name="__codelineno-9-27"></a><span class="c1"># Create the unusual volume strategy</span>
<a href="#__codelineno-9-28" id="__codelineno-9-28" name="__codelineno-9-28"></a><span class="n">unusual_volume_strategy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"buy_signal"</span><span class="p">,</span> <span class="n">when</span><span class="p">((</span><span class="n">col</span><span class="p">(</span><span class="s2">"volume"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">col</span><span class="p">(</span><span class="s2">"mean_volume"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">col</span><span class="p">(</span><span class="s2">"std_volume"</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a href="#__codelineno-9-29" id="__codelineno-9-29" name="__codelineno-9-29"></a>
<a href="#__codelineno-9-30" id="__codelineno-9-30" name="__codelineno-9-30"></a><span class="c1"># Create the alert for the unusual volume strategy</span>
<a href="#__codelineno-9-31" id="__codelineno-9-31" name="__codelineno-9-31"></a><span class="n">unusual_volume_alert</span> <span class="o">=</span> <span class="n">unusual_volume_strategy</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"buy_signal"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"timestamp"</span><span class="p">,</span> <span class="s2">"stock"</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div> <p>In this example, the data is read into a DataFrame using the spark.read.csv() method. The Ichimoku indicators are calculated using the `vbt.indicators</p> </article> </div> </div> </main> <footer class="md-footer"> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> Made with <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank"> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <script id="__config" type="application/json">{"base": "../..", "features": ["search.highlight", "search.suggest", "header.autohide"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src="../../assets/javascripts/bundle.8492ddcf.min.js"></script> <script src="../../assets/javascripts/extra.js"></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body> </html>